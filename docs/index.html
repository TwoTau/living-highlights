<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0"/>
    <meta charset="utf-8" />
    <title>Living Highlights</title>
    <meta property="og:title" content="Living Highlights" />
    <meta property="og:type" content="article" />
    <meta property="og:description" content="Living Highlights" />
    <meta property="description" content="Living Highlights" />
    <style>
article{--section-prefix:"§";--equation-prefix:"Equation ";--figure-prefix:"Figure ";--table-prefix:"Table ";--cite-list-start:"[";--cite-list-end:"]";--double-quote-start:"“";--double-quote-end:"”";--single-quote-start:"‘";--single-quote-end:"’";--highlight-color:#ff0;--tiny-size:0.5em;--script-size:0.7em;--smaller-size:0.8em;--small-size:0.9em;--large-size:1.2em;--larger-size:1.4em;--huge-size:1.8em;--inline-math-size:1em;--ref-color:steelblue;--ref-color-light:#c8dae9;--ref-color-hover:#90b4d2;--ref-color-error:maroon;--ref-weight:500;--ref-decoration:none;width:var(--article-width);margin-left:var(--article-margin-left);padding:var(--article-padding);--inline-math-size:1.14em}a{color:var(--ref-color);font-weight:var(--ref-weight);text-decoration:var(--ref-decoration)}a:hover{color:var(--ref-color-hover)}sub,sup{line-height:0}q{quotes:var(--double-quote-start) var(--double-quote-end)}q.single{quotes:var(--single-quote-start) var(--single-quote-end)}blockquote{margin-left:2em}.action{cursor:pointer;text-decoration:underline dashed 1px #444}header h1{font-size:var(--huge-size)}header .author-org{font-style:italic}header .author-org::before{content:" · "}h1{font-size:1.4rem}h2{font-size:1.2rem}h3{font-size:1.1rem}h4,h5,h6{font-size:1rem}h1[data-counter]::before,h2[data-counter]::before,h3[data-counter]::before{content:attr(data-counter) " "}figure.figure>figcaption[data-counter]::before,figure.teaser>figcaption[data-counter]::before{content:var(--figure-prefix) attr(data-counter) ". "}figure.table>figcaption[data-counter]::before{content:var(--table-prefix) attr(data-counter) ". "}table{border-spacing:0;border-collapse:collapse}thead tr{border-bottom:1px solid #ccc}tbody td,thead th{font-size:var(--small-size);padding:1px .33em;text-align:left;font-variant-numeric:tabular-nums}tbody tr{border-bottom:1px solid #eee}ol.references{padding-inline-start:2em}ol.references li{font-size:var(--small-size);margin-bottom:6px}:root{--max-article-width:110ex;--article-padding:32px;--toc-width:300px;--margin-width:400px;--gap-width:100px;--article-width:min(var(--max-article-width), calc(100vw - var(--article-padding) * 2 - var(--gap-width) * 2 - var(--toc-width) - var(--margin-width)));--article-margin-left:max(0px, calc(((100vw + var(--toc-width) - var(--article-width) - var(--gap-width) * 2 - var(--margin-width)) / 2)))}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit;margin:0;padding:0}h1,h2,h3{padding:0}h1{padding-top:.5em}.title{font-size:24pt;font-weight:700}ol,p,pre,table,ul{margin:0}ol,ul{padding-left:1.5em}section>p{margin-bottom:16px}section>p:last-child{margin-bottom:0}.margin,aside{position:relative;float:right;clear:right;width:var(--margin-width);margin-right:calc(-1 * var(--gap-width) - var(--margin-width));margin-bottom:1em;vertical-align:unset}aside{margin-left:0;margin-top:0}aside>:first-child{margin-top:0}aside>:last-child{margin-bottom:0}.inlinenote-number{line-height:1;padding:1px}.float-left{float:left;margin-right:1em}.float-right{float:right;margin-left:1em}.sticky{position:sticky;top:0;z-index:10}.page{text-align:justify;width:calc(100vw - 2 * var(--article-padding) - 2 * var(--article-margin-left))}figure,pre{max-width:calc(100vw - 2 * var(--article-padding) - 2 * var(--article-margin-left));overflow-x:auto}.full{max-width:100vw}.full-image{width:100%;object-fit:cover;vertical-align:middle}.full figcaption{background:#eee;padding:16px 0}.centered{text-align:center}figure{margin:0;padding:5px 0}aside canvas,aside img,aside svg,figure canvas,figure img,figure svg{object-fit:contain;max-width:100%;height:auto}header{padding-bottom:1em}footer{padding:2em 0}@media (max-width:1600px){:root{--article-width:min(var(--max-article-width), calc(100vw - var(--article-padding) * 2 - var(--gap-width) - var(--margin-width)));--article-margin-left:max(0px, calc(((100vw - var(--article-width) - var(--gap-width) - var(--margin-width)) / 2)))}table-of-contents{display:none}}@media (max-width:1100px){:root{--article-padding:16px}article{width:min(var(--max-article-width),calc(100% - var(--article-padding) * 2))}figure,pre{max-width:calc(100vw - var(--article-padding) * 2)}.page{width:min(var(--max-article-width),100%)}.margin,aside{float:none;margin:0;width:auto}.inline-note-number{cursor:pointer;padding:1px 4px}.inline-note .note::before,.inline-note:not(.open) .note{display:none}}@media print{.sticky{position:relative}}table-of-contents{position:fixed;top:calc(2 * var(--article-padding));left:calc(var(--article-margin-left) - var(--toc-width));height:calc(100vh - 4 * var(--article-padding));overflow-y:auto}table-of-contents ol{width:fit-content;max-width:var(--toc-width);margin:0;padding-left:0;list-style:none}table-of-contents li{margin:1ex 0;padding-left:16px;border-left:2px solid #212e6d11}table-of-contents li:hover{border-left-width:4px;padding-left:14px}table-of-contents li.active{border-color:#000}table-of-contents li.active-parent>a{color:#000}table-of-contents li.active>a{font-weight:700}table-of-contents a{font-weight:inherit}:not(.katex-display)>.katex{font-size:var(--inline-math-size)!important}.math-aug-window{z-index:99;position:absolute;border-bottom:2px solid #000;transform:translate(-50px,-40px);background:#fff;border-radius:2px;padding:1px 5px;filter:drop-shadow(1px 1px 2px rgba(0, 0, 0, .2))}annotation-thread{--highlight-color:#FAFA44;--border-color:rgba(38, 41, 50, 1.0);--ui-element-color:rgba(217, 214, 205, 1.0);--tray-color:rgba(128, 128, 128, 0.3);--thread-color:rgba(150, 150, 150, 0.6)}.anno-tray{width:420px;height:100vh;background-color:var(--tray-color);backdrop-filter:blur(5px);border-left:1px solid var(--border-color);box-sizing:border-box}.anno-tray,.thread-text{-ms-overflow-style:none;scrollbar-width:none;overflow:auto}.anno-tray::-webkit-scrollbar,.thread-text::-webkit-scrollbar{display:none}.anno-threads{position:absolute;display:flex;align-items:center;justify-content:space-between;flex-direction:column;width:100%;height:auto;top:50px;padding-top:10px}.thread-info{display:flex;flex-direction:row;font-weight:bolder;font-size:larger;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border-color)}.thread-type{width:100px;text-align:right}.thread-text{margin:10px;max-height:100px;font-style:italic}.thread-username{width:200px;text-align:left}.thread-datetime{display:flex;justify-content:right;align-items:right;padding:10px;font-size:x-small}.thread-comment{min-height:20px;margin:10px}.thread{background-color:var(--thread-color);min-height:150px;width:380px;margin:10px;border-radius:5px;overflow:hidden;border:1px solid var(--border-color)}.title{display:flex;height:100%;width:80%;text-align:center;align-items:center;justify-content:center}.top-nav{position:sticky;z-index:1;top:0;background-color:var(--ui-element-color);width:100%;height:50px;display:flex;flex-direction:row;justify-content:space-around;align-items:center;border-bottom:1px solid var(--border-color)}.anno-side-tray{position:absolute;display:flex;top:0;right:420px;width:30px;height:300px;overflow:hidden;background-color:transparent;border-bottom-left-radius:30px;transition:width .6s cubic-bezier(.05, .4, .25, .95),height .6s cubic-bezier(.05, .4, .25, .95);justify-content:right}.anno-color{position:absolute;left:90px;top:104px;height:80px}.anno-button,.anno-color-button{position:absolute;display:flex;justify-content:center;align-items:center;box-sizing:border-box;width:30px;cursor:pointer;background-color:var(--ui-element-color);transition:transform .6s cubic-bezier(.05, .4, .25, .95)}.anno-color-button{height:31px;top:169px;font-weight:bolder;border:1px solid var(--border-color);border-right:none}.anno-button{top:200px;height:100px;color:#000;font-size:1.4em;border-bottom-left-radius:30px;border-left:1px solid var(--border-color);border-bottom:1px solid var(--border-color)}.anno{top:0;z-index:99;right:-420px;position:fixed;transition:transform .9s cubic-bezier(.05, .4, .25, .95)}.annotation-highlight{background:var(--highlight-color);cursor:pointer;transition:filter .1s ease-out}.annotation-highlight:hover,.hovered,.thread:hover{filter:brightness(85%)}.annotation-highlight:hover{padding:2px;margin:0 -2px}.anno-tooltip{display:flex;position:absolute;background-color:#d9d6cd;border:1px solid #262932;border-radius:2px;z-index:2}.tooltip-highlight,.tooltip-remove,.tooltip-tweet{display:flex;align-items:center;justify-content:center;cursor:pointer;width:30px;height:30px;transition:background-color .1s ease-out}.tooltip-tweet{border-right:1px solid #262932}.icon-highlight,.icon-remove,.icon-tweet{width:25px;height:25px}.icon-tweet{background-image:url(assets/twitterbird.svg)}.icon-highlight{background-image:url(assets/highlighter.svg)}.tooltip-highlight:hover,.tooltip-tweet:hover{background-color:rgba(150,150,150,.6)}body{font:16px/1.5 -apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";background:#fff;color:#000}:not(pre)>code,pre{font-family:monospace;font-size:15px}h1,h2,h3,h4,h5,h6{font-weight:600;line-height:1.25em;margin:24px 0 16px}h1,h2{border-bottom:1px solid rgba(0,0,0,.1);padding-bottom:6px;width:fit-content}.katex-display,article p,article>ol,article>table,article>ul{margin:12px 0}td,th{border-bottom:1px solid rgba(0,0,0,.2);transition:.1s ease-out}th,tr:hover td{background:rgba(0,0,0,.1)}figure>figcaption{font-weight:600;font-size:var(--small-size);line-height:1.4em;padding-bottom:1ex}.sticky{background:rgba(255,255,255,.8);backdrop-filter:blur(4px)}.note,aside{font-style:inherit;font-size:var(--small-size)}.note{background:#fff;transition:.1s ease-out}.inline-note:hover .inline-note-number,.inline-note:hover .note{background:var(--ref-color-light)}.inline-note .note::before{font-size:var(--smaller-size)}.normal{font-weight:400}.demi{font-weight:600}.bold,.strong{font-weight:700}.code,.mono{font-family:monospace}.em,.emph,.italic{font-style:italic}.highlight{background-color:var(--highlight-color)}.strike{text-decoration:line-through}.underline{text-decoration:underline}.smallcaps{font-variant:small-caps}.lowercase{text-transform:lowercase}.uppercase{text-transform:uppercase}.capitalize{text-transform:capitalize}.left{text-align:left}.right{text-align:right}.center{text-align:center}.justify{text-align:justify}.tiny{font-size:var(--tiny-size)}.scriptsize{font-size:var(--script-size)}.footnotesize,.smaller{font-size:var(--smaller-size)}.small{font-size:var(--small-size)}.large{font-size:var(--large-size)}.larger{font-size:var(--larger-size)}.huge{font-size:var(--huge-size)}.hide,.thread.type-highlight{display:none}.sticky:has(#fig2){top:32px}.maug{color:#8a2be2;display:inline-block;cursor:pointer}.maug:hover{background:rgba(103,176,202,.22)}.maug-fxh{color:#00f}.maug-dxh{color:#00008b}.maug-fprimeprimex{color:#8b0000}.maug-alpha{color:#db7093}.maug-beta{color:#663399}.maug-fx{color:#00f}.maug-gx{color:#006400}.maug-fprimex{color:#00008b}.maug-gprimex{color:#556b2f}.maug-wx{color:#8b0000}.maug-h{color:purple}.maug-x{color:red}.maug-r{color:orange}.maug-m,.maug-n{color:sienna}.maug-a{color:#8b0000}.maug-5{color:sienna}:root,[data-theme=default]{--base-background-color:rgba(38, 41, 50, 1.0);--thumb-border-color:rgba(255, 255, 255, 0.7);--color-wheel-control-box-shadow:0px 0px 5px 0px rgba(0, 0, 0, 0.85) inset;--brightness-control-box-shadow:0px 0px 5px 0px rgba(0, 0, 0, 0.5) inset;--input-controls-tab-header-background-color:rgba(41, 45, 53, 1.0);--input-controls-tab-header-font-color:rgba(255, 255, 255, 1.0);--input-controls-tab-background-color:rgba(0, 0, 0, 0.1);--range-input-control-background-color:rgba(55, 61, 71, 0.6);--range-input-control-background-color--focused:rgba(55, 61, 71, 0.5);--range-input-control-font-color:rgba(255, 255, 255, 1.0);--range-input-control-selection-color:rgba(0, 0, 0, 0.5);--range-input-control-progress-color:rgba(37, 43, 48, 1.0);--text-input-control-background-color:rgba(55, 61, 71, 0.6);--text-input-control-background-color--focused:rgba(55, 61, 71, 0.5);--text-input-control-font-color:rgba(255, 255, 255, 1.0);--text-input-control-selection-color:rgba(0, 0, 0, 0.5)}[data-theme=light]{--base-background-color:rgba(217, 214, 205, 1.0);--thumb-border-color:rgba(255, 255, 255, 0.7);--color-wheel-control-box-shadow:0px 0px 5px 0px rgba(0, 0, 0, 0.45) inset;--brightness-control-box-shadow:0px 0px 5px 0px rgba(0, 0, 0, 0.25) inset;--input-controls-tab-header-background-color:rgba(221, 218, 210, 1.0);--input-controls-tab-header-font-color:rgba(35, 35, 35, 1.0);--input-controls-tab-background-color:rgba(122, 122, 122, 0.1);--range-input-control-background-color:rgba(221, 218, 210, 0.6);--range-input-control-background-color--focused:rgba(222, 220, 220, 0.5);--range-input-control-font-color:rgba(35, 35, 35, 1.0);--range-input-control-selection-color:rgba(255, 255, 255, 0.5);--range-input-control-progress-color:rgba(228, 228, 228, 1.0);--text-input-control-background-color:rgba(221, 218, 210, 0.6);--text-input-control-background-color--focused:rgba(222, 220, 220, 0.5);--text-input-control-font-color:rgba(35, 35, 35, 1.0);--text-input-control-selection-color:rgba(255, 255, 255, 0.5)}.color-picker{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:180px;height:auto;min-height:226px;box-sizing:border-box;border-left:1px solid #262932;border-bottom:1px solid #262932;background:var(--base-background-color);border-bottom-left-radius:5px;-webkit-box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);-moz-box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.color-picker-controls{position:relative;width:100%;height:auto;display:flex;flex-direction:column}.color-picker-controls-group{position:relative;display:block;align-items:center;width:auto;padding:10px}.color-picker-wheel-control{position:relative;display:flex;flex-direction:row;height:140px;width:140px;border:none}.color-picker-wheel-control::after{content:'';position:absolute;display:block;top:0;left:0;width:100%;height:100%;border:1px solid var(--base-background-color);border-radius:50%;-webkit-box-shadow:var(--color-wheel-control-box-shadow);-moz-box-shadow:var(--color-wheel-control-box-shadow);box-shadow:var(--color-wheel-control-box-shadow);margin:-1px;pointer-events:none}.color-picker-brightness-control{position:relative;display:flex;flex-direction:row;height:100%;width:8px;border:1px solid transparent;border-radius:3px;margin-right:10px}.color-picker-brightness-control::after{content:'';position:absolute;display:block;top:0;left:0;width:100%;height:100%;border-radius:3px;-webkit-box-shadow:var(--brightness-control-box-shadow);-moz-box-shadow:var(--brightness-control-box-shadow);box-shadow:var(--brightness-control-box-shadow);pointer-events:none}.color-picker-brightness-control-thumb,.color-picker-wheel-control-thumb{position:absolute;display:block;width:10px;height:10px;border:1px solid var(--thumb-border-color);border-radius:50%;-webkit-box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);-moz-box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer;z-index:1}.brightness-canvas,.wheel-canvas{width:100%;height:100%;border-radius:3px}.color-picker-input-controls{position:relative;width:100%;height:100%;display:flex;flex-direction:column;background:var(--input-controls-tab-background-color);border-radius:3px;overflow:hidden}.color-picker-input-controls-tab-headers{position:relative;display:flex;flex-direction:row;width:100%;height:25px;overflow:hidden}.color-picker-input-controls-tab-headers button{position:relative;display:block;width:33.33%;height:100%;background:var(--input-controls-tab-header-background-color);font-size:9px;color:var(--input-controls-tab-header-font-color);border:none;outline:0}.color-picker-input-controls-tab-headers button.selected{background:0 0}.color-picker-input-controls-tabs{position:relative;display:block;width:100%;height:auto;padding:4px}.color-picker-input-controls-tab{position:relative;display:flex;flex-direction:column}.color-picker-input-controls-tab:not(.selected){display:none}input{font-size:100%}input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-moz-appearance:textfield}.range-input-control{position:relative;display:block;width:100%;height:auto;min-height:20px;margin:1px 0 0;background:var(--range-input-control-background-color);font-size:10px;cursor:ew-resize;overflow:hidden}.range-input-control.range-input-control--focused,.range-input-control:hover{background:var(--range-input-control-background-color--focused)}.range-input-control:first-child{border-top-left-radius:3px;border-top-right-radius:3px}.range-input-control:last-child{border-bottom-left-radius:3px;border-bottom-right-radius:3px}.range-input-control .range-input-details-block,.range-input-control .range-input-enter-block{position:absolute;display:block;top:0;left:0;right:0;bottom:0}.range-input-control:not(.range-input-control--key-input-mode) .range-input-enter-block{display:none}.range-input-control.range-input-control--key-input-mode .range-input-enter-block,.range-input-control:not(.range-input-control--key-input-mode) .range-input-details-block{display:block}.range-input-control.range-input-control--key-input-mode .range-input-details-block{display:none}.range-input-control input{position:absolute;display:block;top:50%;transform:translate(0,-50%);width:100%;height:auto;background:0 0;border:none;color:var(--range-input-control-font-color);text-align:center;outline:0}.range-input-control input::-moz-selection{background:var(--range-input-control-selection-color)}.range-input-control input::selection{background:var(--range-input-control-selection-color)}.range-input-control .range-input-progress{position:absolute;display:block;top:0;left:0;height:100%;background:var(--range-input-control-progress-color)}.range-input-control .range-input-label,.range-input-control .range-input-value{position:absolute;display:block;top:50%;width:auto;height:auto;transform:translate(0,-50%);color:var(--range-input-control-font-color);pointer-events:none}.range-input-control .range-input-label{left:5px}.range-input-control .range-input-value{right:5px}.text-input-control{position:relative;display:block;width:100%;height:auto;min-height:20px;background:var(--text-input-control-background-color);font-size:10px;margin:1px 0 0;cursor:text;overflow:hidden}.text-input-control.text-input-control--focused,.text-input-control:hover{background:var(--text-input-control-background-color--focused)}.text-input-control:first-child{border-top-left-radius:3px;border-top-right-radius:3px}.text-input-control:last-child{border-bottom-left-radius:3px;border-bottom-right-radius:3px}.text-input-control .text-input-details-block,.text-input-control .text-input-enter-block{position:absolute;display:block;top:0;left:0;right:0;bottom:0}.text-input-control:not(.text-input-control--focused) .text-input-enter-block{display:none}.text-input-control.text-input-control--focused .text-input-enter-block,.text-input-control:not(.text-input-control--focused) .text-input-details-block{display:block}.text-input-control.text-input-control--focused .text-input-details-block{display:none}.text-input-control input{position:absolute;display:block;top:50%;transform:translate(0,-50%);width:100%;height:auto;background:0 0;color:var(--text-input-control-font-color);text-align:center;border:none;outline:0}.text-input-control input::-moz-selection{background:var(--text-input-control-selection-color)}.text-input-control input::selection{background:var(--text-input-control-selection-color)}.text-input-control .text-input-label,.text-input-control .text-input-value{position:absolute;display:block;top:50%;width:auto;height:auto;transform:translate(0,-50%);color:var(--text-input-control-font-color);pointer-events:none}.text-input-control .text-input-label{left:5px}.text-input-control .text-input-value{right:5px}
    </style>
  </head>
  <body>
    <article><table-of-contents><ol><li>Abstract<ol></ol></li><li><a href="#introduction">Introduction</a><ol><li><a href="#goals">Goals</a><ol></ol></li><li><a href="#related-work">Related work</a><ol></ol></li></ol></li><li><a href="#implementation">Implementation</a><ol><li><a href="#ui">UI</a><ol></ol></li><li><a href="#text-fragments">Text fragments</a><ol></ol></li><li><a href="#twitter-web-intents">Twitter web intents</a><ol></ol></li><li><a href="#living-highlights-server">Living Highlights server</a><ol></ol></li></ol></li><li><a href="#limitations">Limitations</a><ol><li><a href="#early-adoption">(Early) adoption</a><ol></ol></li><li><a href="#day-search-limit">7-day search limit</a><ol></ol></li><li><a href="#equation-highlighting">Equation highlighting</a><ol></ol></li><li><a href="#text-fragment-generation">Text fragment generation</a><ol></ol></li><li><a href="#recent-events-at-twitter">Recent events at Twitter</a><ol></ol></li></ol></li></ol></table-of-contents><header><h1 role="banner">Living Highlights</h1><div class="author"><span class="author-name">Vishal Devireddy</span><span class="author-org">University of Washington</span></div><div class="author"><span class="author-name">Tu Nguyen</span><span class="author-org">University of Washington</span></div></header><p><annotation-thread></annotation-thread></p><h1 nonumber="true">Abstract</h1><p>This project adds reader <q>highlights</q> and social annotations to Living Papers documents.</p><h1 id="introduction" data-counter="1">Introduction</h1><h2 id="goals" data-counter="1.1">Goals</h2><p>todo</p><h2 id="related-work" data-counter="1.2">Related work</h2><p>todo: see references</p><h1 id="implementation" data-counter="2">Implementation</h1><p>The main components of our implementation are the UI, Text Fragments, Twitter web intents, and our server that searches Twitter.</p><h2 id="ui" data-counter="2.1">UI</h2><p>todo: Tu</p><h2 id="text-fragments" data-counter="2.2">Text fragments</h2><p><a href="https://web.dev/text-fragments/">Text fragments</a> are</p><h2 id="twitter-web-intents" data-counter="2.3">Twitter web intents</h2><p>todo</p><h2 id="living-highlights-server" data-counter="2.4">Living Highlights server</h2><p>We need a server to use the Twitter API.</p><h1 id="limitations" data-counter="3">Limitations</h1><h2 id="early-adoption" data-counter="3.1">(Early) adoption</h2><q>Systemic reform always faces a bootstrap problem: early adopters gain little benefit (because no one else is participating in the new system yet) and suffer high costs.</q>— Christopher Lee, author of the now discontinued Selected-Papers Network<p>Early adoption is the biggest problem that all social annotation platforms face.</p><h2 id="day-search-limit" data-counter="3.2">7-day search limit</h2><p>Twitter limits API users to only searching through the past week of Tweets.</p><h2 id="equation-highlighting" data-counter="3.3">Equation highlighting</h2><p>Currently, highlighting equations sometimes leads to slightly incorrect tweet text. For example, if you highlight part of this equation <tex-math mode="inline" code="F(@x + @h) \approx F(@x) + @hF&#39;(@x)" definitions="[{&quot;replace&quot;:&quot;F(@x + @h)&quot;,&quot;symbol&quot;:&quot;F(@x + @h)&quot;,&quot;id&quot;:&quot;fxh&quot;,&quot;definition&quot;:&quot;The best translated $F(@x)$ to approximate $G(@x)$&quot;},{&quot;replace&quot;:&quot;F&#39;(@x)&quot;,&quot;symbol&quot;:&quot;F&#39;(@x)&quot;,&quot;id&quot;:&quot;fprimex&quot;,&quot;definition&quot;:&quot;Linear approximation of $F(x)$ in the neighborhood of $@x$&quot;},{&quot;replace&quot;:&quot;F(@x)&quot;,&quot;symbol&quot;:&quot;F(@x)&quot;,&quot;id&quot;:&quot;fx&quot;,&quot;definition&quot;:&quot;The first stereo image&quot;},{&quot;replace&quot;:&quot;G(@x)&quot;,&quot;symbol&quot;:&quot;G(@x)&quot;,&quot;id&quot;:&quot;gx&quot;,&quot;definition&quot;:&quot;The second stereo image&quot;},{&quot;replace&quot;:&quot;F(x)&quot;,&quot;symbol&quot;:&quot;F(x)&quot;,&quot;id&quot;:&quot;fx&quot;,&quot;definition&quot;:&quot;The first stereo image&quot;},{&quot;replace&quot;:&quot;G(x)&quot;,&quot;symbol&quot;:&quot;G(x)&quot;,&quot;id&quot;:&quot;gx&quot;,&quot;definition&quot;:&quot;The second stereo image&quot;},{&quot;replace&quot;:&quot;@h&quot;,&quot;symbol&quot;:&quot;h&quot;,&quot;id&quot;:&quot;h&quot;,&quot;definition&quot;:&quot;disparity vector&quot;},{&quot;replace&quot;:&quot;@x&quot;,&quot;symbol&quot;:&quot;x&quot;,&quot;id&quot;:&quot;x&quot;,&quot;definition&quot;:&quot;position vector in an image&quot;},{&quot;replace&quot;:&quot;@R&quot;,&quot;symbol&quot;:&quot;R&quot;,&quot;id&quot;:&quot;r&quot;,&quot;definition&quot;:&quot;Region of interest&quot;}]"></tex-math> describing <tex-math mode="inline" code="F(@x)" definitions="[{&quot;replace&quot;:&quot;F(@x + @h)&quot;,&quot;symbol&quot;:&quot;F(@x + @h)&quot;,&quot;id&quot;:&quot;fxh&quot;,&quot;definition&quot;:&quot;The best translated $F(@x)$ to approximate $G(@x)$&quot;},{&quot;replace&quot;:&quot;F&#39;(@x)&quot;,&quot;symbol&quot;:&quot;F&#39;(@x)&quot;,&quot;id&quot;:&quot;fprimex&quot;,&quot;definition&quot;:&quot;Linear approximation of $F(x)$ in the neighborhood of $@x$&quot;},{&quot;replace&quot;:&quot;F(@x)&quot;,&quot;symbol&quot;:&quot;F(@x)&quot;,&quot;id&quot;:&quot;fx&quot;,&quot;definition&quot;:&quot;The first stereo image&quot;},{&quot;replace&quot;:&quot;G(@x)&quot;,&quot;symbol&quot;:&quot;G(@x)&quot;,&quot;id&quot;:&quot;gx&quot;,&quot;definition&quot;:&quot;The second stereo image&quot;},{&quot;replace&quot;:&quot;F(x)&quot;,&quot;symbol&quot;:&quot;F(x)&quot;,&quot;id&quot;:&quot;fx&quot;,&quot;definition&quot;:&quot;The first stereo image&quot;},{&quot;replace&quot;:&quot;G(x)&quot;,&quot;symbol&quot;:&quot;G(x)&quot;,&quot;id&quot;:&quot;gx&quot;,&quot;definition&quot;:&quot;The second stereo image&quot;},{&quot;replace&quot;:&quot;@h&quot;,&quot;symbol&quot;:&quot;h&quot;,&quot;id&quot;:&quot;h&quot;,&quot;definition&quot;:&quot;disparity vector&quot;},{&quot;replace&quot;:&quot;@x&quot;,&quot;symbol&quot;:&quot;x&quot;,&quot;id&quot;:&quot;x&quot;,&quot;definition&quot;:&quot;position vector in an image&quot;},{&quot;replace&quot;:&quot;@R&quot;,&quot;symbol&quot;:&quot;R&quot;,&quot;id&quot;:&quot;r&quot;,&quot;definition&quot;:&quot;Region of interest&quot;}]"></tex-math> and <tex-math mode="inline" code="F&#39;(@x)" definitions="[{&quot;replace&quot;:&quot;F(@x + @h)&quot;,&quot;symbol&quot;:&quot;F(@x + @h)&quot;,&quot;id&quot;:&quot;fxh&quot;,&quot;definition&quot;:&quot;The best translated $F(@x)$ to approximate $G(@x)$&quot;},{&quot;replace&quot;:&quot;F&#39;(@x)&quot;,&quot;symbol&quot;:&quot;F&#39;(@x)&quot;,&quot;id&quot;:&quot;fprimex&quot;,&quot;definition&quot;:&quot;Linear approximation of $F(x)$ in the neighborhood of $@x$&quot;},{&quot;replace&quot;:&quot;F(@x)&quot;,&quot;symbol&quot;:&quot;F(@x)&quot;,&quot;id&quot;:&quot;fx&quot;,&quot;definition&quot;:&quot;The first stereo image&quot;},{&quot;replace&quot;:&quot;G(@x)&quot;,&quot;symbol&quot;:&quot;G(@x)&quot;,&quot;id&quot;:&quot;gx&quot;,&quot;definition&quot;:&quot;The second stereo image&quot;},{&quot;replace&quot;:&quot;F(x)&quot;,&quot;symbol&quot;:&quot;F(x)&quot;,&quot;id&quot;:&quot;fx&quot;,&quot;definition&quot;:&quot;The first stereo image&quot;},{&quot;replace&quot;:&quot;G(x)&quot;,&quot;symbol&quot;:&quot;G(x)&quot;,&quot;id&quot;:&quot;gx&quot;,&quot;definition&quot;:&quot;The second stereo image&quot;},{&quot;replace&quot;:&quot;@h&quot;,&quot;symbol&quot;:&quot;h&quot;,&quot;id&quot;:&quot;h&quot;,&quot;definition&quot;:&quot;disparity vector&quot;},{&quot;replace&quot;:&quot;@x&quot;,&quot;symbol&quot;:&quot;x&quot;,&quot;id&quot;:&quot;x&quot;,&quot;definition&quot;:&quot;position vector in an image&quot;},{&quot;replace&quot;:&quot;@R&quot;,&quot;symbol&quot;:&quot;R&quot;,&quot;id&quot;:&quot;r&quot;,&quot;definition&quot;:&quot;Region of interest&quot;}]"></tex-math> and open the Tweet intent, you will get a correct result:</p><pre><code>&quot;this equation F(x+h)≈F(x)+hF′(x) describing&quot;</code></pre><p>but highlighting a equation with fractions <tex-math mode="inline" code="L_2 \, \text{norm} = (\sum_{x \varepsilon @R} [ @F(x + @h) - G(@x) ]^2)^{\frac{1}{2}}" definitions="[{&quot;replace&quot;:&quot;F(@x + @h)&quot;,&quot;symbol&quot;:&quot;F(@x + @h)&quot;,&quot;id&quot;:&quot;fxh&quot;,&quot;definition&quot;:&quot;The best translated $F(@x)$ to approximate $G(@x)$&quot;},{&quot;replace&quot;:&quot;F&#39;(@x)&quot;,&quot;symbol&quot;:&quot;F&#39;(@x)&quot;,&quot;id&quot;:&quot;fprimex&quot;,&quot;definition&quot;:&quot;Linear approximation of $F(x)$ in the neighborhood of $@x$&quot;},{&quot;replace&quot;:&quot;F(@x)&quot;,&quot;symbol&quot;:&quot;F(@x)&quot;,&quot;id&quot;:&quot;fx&quot;,&quot;definition&quot;:&quot;The first stereo image&quot;},{&quot;replace&quot;:&quot;G(@x)&quot;,&quot;symbol&quot;:&quot;G(@x)&quot;,&quot;id&quot;:&quot;gx&quot;,&quot;definition&quot;:&quot;The second stereo image&quot;},{&quot;replace&quot;:&quot;F(x)&quot;,&quot;symbol&quot;:&quot;F(x)&quot;,&quot;id&quot;:&quot;fx&quot;,&quot;definition&quot;:&quot;The first stereo image&quot;},{&quot;replace&quot;:&quot;G(x)&quot;,&quot;symbol&quot;:&quot;G(x)&quot;,&quot;id&quot;:&quot;gx&quot;,&quot;definition&quot;:&quot;The second stereo image&quot;},{&quot;replace&quot;:&quot;@h&quot;,&quot;symbol&quot;:&quot;h&quot;,&quot;id&quot;:&quot;h&quot;,&quot;definition&quot;:&quot;disparity vector&quot;},{&quot;replace&quot;:&quot;@x&quot;,&quot;symbol&quot;:&quot;x&quot;,&quot;id&quot;:&quot;x&quot;,&quot;definition&quot;:&quot;position vector in an image&quot;},{&quot;replace&quot;:&quot;@R&quot;,&quot;symbol&quot;:&quot;R&quot;,&quot;id&quot;:&quot;r&quot;,&quot;definition&quot;:&quot;Region of interest&quot;}]"></tex-math> breaks the <tex-math mode="inline" code="\frac{1}{2}" definitions="[{&quot;replace&quot;:&quot;F(@x + @h)&quot;,&quot;symbol&quot;:&quot;F(@x + @h)&quot;,&quot;id&quot;:&quot;fxh&quot;,&quot;definition&quot;:&quot;The best translated $F(@x)$ to approximate $G(@x)$&quot;},{&quot;replace&quot;:&quot;F&#39;(@x)&quot;,&quot;symbol&quot;:&quot;F&#39;(@x)&quot;,&quot;id&quot;:&quot;fprimex&quot;,&quot;definition&quot;:&quot;Linear approximation of $F(x)$ in the neighborhood of $@x$&quot;},{&quot;replace&quot;:&quot;F(@x)&quot;,&quot;symbol&quot;:&quot;F(@x)&quot;,&quot;id&quot;:&quot;fx&quot;,&quot;definition&quot;:&quot;The first stereo image&quot;},{&quot;replace&quot;:&quot;G(@x)&quot;,&quot;symbol&quot;:&quot;G(@x)&quot;,&quot;id&quot;:&quot;gx&quot;,&quot;definition&quot;:&quot;The second stereo image&quot;},{&quot;replace&quot;:&quot;F(x)&quot;,&quot;symbol&quot;:&quot;F(x)&quot;,&quot;id&quot;:&quot;fx&quot;,&quot;definition&quot;:&quot;The first stereo image&quot;},{&quot;replace&quot;:&quot;G(x)&quot;,&quot;symbol&quot;:&quot;G(x)&quot;,&quot;id&quot;:&quot;gx&quot;,&quot;definition&quot;:&quot;The second stereo image&quot;},{&quot;replace&quot;:&quot;@h&quot;,&quot;symbol&quot;:&quot;h&quot;,&quot;id&quot;:&quot;h&quot;,&quot;definition&quot;:&quot;disparity vector&quot;},{&quot;replace&quot;:&quot;@x&quot;,&quot;symbol&quot;:&quot;x&quot;,&quot;id&quot;:&quot;x&quot;,&quot;definition&quot;:&quot;position vector in an image&quot;},{&quot;replace&quot;:&quot;@R&quot;,&quot;symbol&quot;:&quot;R&quot;,&quot;id&quot;:&quot;r&quot;,&quot;definition&quot;:&quot;Region of interest&quot;}]"></tex-math>:</p><pre><code>&quot;equation with fractions L2​norm=(∑xεR​[F(x+h)−G(x)]2)21&quot;</code></pre><p>Possible solutions include serializing the equation or rendering a screenshot. Serializing a LaTeX equation requires converting it into text that is both readable and short (to get under the tweet length limit). Alternatively, we could include a rendered image of the selected text in the tweet. This preserves the structure of the equation, but isn’t ideal for searchability or accessibility.</p><h2 id="text-fragment-generation" data-counter="3.4">Text fragment generation</h2><p>It is not always possible to generate a text fragment that uniquely identifies a selection of text. In these cases, the link in the Tweet only includes the URL of the page.</p><h2 id="recent-events-at-twitter" data-counter="3.5">Recent events at Twitter</h2><p>todo: explain Twitter imploding, how does that affect academic Twitter users?</p><bibliography></bibliography></article>
    <script type="module">
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const e=window,t=e.ShadowRoot&&(void 0===e.ShadyCSS||e.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,n=Symbol(),s=new WeakMap;class i{constructor(e,t,s){if(this._$cssResult$=!0,s!==n)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const n=this.t;if(t&&void 0===e){const t=void 0!==n&&1===n.length;t&&(e=s.get(n)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),t&&s.set(n,e))}return e}toString(){return this.cssText}}const r=t?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>new i("string"==typeof e?e:e+"",void 0,n))(t)})(e):e
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var o;const u=window,a=u.trustedTypes,l=a?a.emptyScript:"",c=u.reactiveElementPolyfillSupport,d={toAttribute(e,t){switch(t){case Boolean:e=e?l:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},h=(e,t)=>t!==e&&(t==t||e==e),f={attribute:!0,type:String,converter:d,reflect:!1,hasChanged:h};class p extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var t;null!==(t=this.h)&&void 0!==t||(this.h=[]),this.h.push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,n)=>{const s=this._$Ep(n,t);void 0!==s&&(this._$Ev.set(s,n),e.push(s))})),e}static createProperty(e,t=f){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const n="symbol"==typeof e?Symbol():"__"+e,s=this.getPropertyDescriptor(e,n,t);void 0!==s&&Object.defineProperty(this.prototype,e,s)}}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(s){const i=this[e];this[t]=s,this.requestUpdate(e,i,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||f}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const n of t)this.createProperty(n,e[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(r(e))}else void 0!==e&&t.push(r(e));return t}static _$Ep(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(e=this.constructor.h)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,n;(null!==(t=this._$ES)&&void 0!==t?t:this._$ES=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(n=e.hostConnected)||void 0===n||n.call(e))}removeController(e){var t;null===(t=this._$ES)||void 0===t||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var n;const s=null!==(n=this.shadowRoot)&&void 0!==n?n:this.attachShadow(this.constructor.shadowRootOptions);return((n,s)=>{t?n.adoptedStyleSheets=s.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):s.forEach((t=>{const s=document.createElement("style"),i=e.litNonce;void 0!==i&&s.setAttribute("nonce",i),s.textContent=t.cssText,n.appendChild(s)}))})(s,this.constructor.elementStyles),s}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EO(e,t,n=f){var s;const i=this.constructor._$Ep(e,n);if(void 0!==i&&!0===n.reflect){const r=(void 0!==(null===(s=n.converter)||void 0===s?void 0:s.toAttribute)?n.converter:d).toAttribute(t,n.type);this._$El=e,null==r?this.removeAttribute(i):this.setAttribute(i,r),this._$El=null}}_$AK(e,t){var n;const s=this.constructor,i=s._$Ev.get(e);if(void 0!==i&&this._$El!==i){const e=s.getPropertyOptions(i),r="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null===(n=e.converter)||void 0===n?void 0:n.fromAttribute)?e.converter:d;this._$El=i,this[i]=r.fromAttribute(t,e.type),this._$El=null}}requestUpdate(e,t,n){let s=!0;void 0!==e&&(((n=n||this.constructor.getPropertyOptions(e)).hasChanged||h)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===n.reflect&&this._$El!==e&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(e,n))):s=!1),!this.isUpdatePending&&s&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(n)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(n)}willUpdate(e){}_$AE(e){var t;null===(t=this._$ES)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){void 0!==this._$EC&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var g;p.finalized=!0,p.elementProperties=new Map,p.elementStyles=[],p.shadowRootOptions={mode:"open"},null==c||c({ReactiveElement:p}),(null!==(o=u.reactiveElementVersions)&&void 0!==o?o:u.reactiveElementVersions=[]).push("1.4.1");const m=window,v=m.trustedTypes,_=v?v.createPolicy("lit-html",{createHTML:e=>e}):void 0,b=`lit$${(Math.random()+"").slice(9)}$`,w="?"+b,E=`<${w}>`,y=document,A=(e="")=>y.createComment(e),S=e=>null===e||"object"!=typeof e&&"function"!=typeof e,D=Array.isArray,x=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,F=/-->/g,C=/>/g,T=RegExp(">|[ \t\n\f\r](?:([^\\s\"'>=/]+)([ \t\n\f\r]*=[ \t\n\f\r]*(?:[^ \t\n\f\r\"'`<>=]|(\"|')|))|$)","g"),O=/'/g,N=/"/g,k=/^(?:script|style|textarea|title)$/i,$=(e=>(t,...n)=>({_$litType$:e,strings:t,values:n}))(1),R=Symbol.for("lit-noChange"),L=Symbol.for("lit-nothing"),B=new WeakMap,P=y.createTreeWalker(y,129,null,!1),M=(e,t)=>{const n=e.length-1,s=[];let i,r=2===t?"<svg>":"",o=x;for(let t=0;t<n;t++){const n=e[t];let u,a,l=-1,c=0;for(;c<n.length&&(o.lastIndex=c,a=o.exec(n),null!==a);)c=o.lastIndex,o===x?"!--"===a[1]?o=F:void 0!==a[1]?o=C:void 0!==a[2]?(k.test(a[2])&&(i=RegExp("</"+a[2],"g")),o=T):void 0!==a[3]&&(o=T):o===T?">"===a[0]?(o=null!=i?i:x,l=-1):void 0===a[1]?l=-2:(l=o.lastIndex-a[2].length,u=a[1],o=void 0===a[3]?T:'"'===a[3]?N:O):o===N||o===O?o=T:o===F||o===C?o=x:(o=T,i=void 0);const d=o===T&&e[t+1].startsWith("/>")?" ":"";r+=o===x?n+E:l>=0?(s.push(u),n.slice(0,l)+"$lit$"+n.slice(l)+b+d):n+b+(-2===l?(s.push(void 0),t):d)}const u=r+(e[n]||"<?>")+(2===t?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==_?_.createHTML(u):u,s]};class I{constructor({strings:e,_$litType$:t},n){let s;this.parts=[];let i=0,r=0;const o=e.length-1,u=this.parts,[a,l]=M(e,t);if(this.el=I.createElement(a,n),P.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(s=P.nextNode())&&u.length<o;){if(1===s.nodeType){if(s.hasAttributes()){const e=[];for(const t of s.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(b)){const n=l[r++];if(e.push(t),void 0!==n){const e=s.getAttribute(n.toLowerCase()+"$lit$").split(b),t=/([.?@])?(.*)/.exec(n);u.push({type:1,index:i,name:t[2],strings:e,ctor:"."===t[1]?X:"?"===t[1]?Y:"@"===t[1]?z:q})}else u.push({type:6,index:i})}for(const t of e)s.removeAttribute(t)}if(k.test(s.tagName)){const e=s.textContent.split(b),t=e.length-1;if(t>0){s.textContent=v?v.emptyScript:"";for(let n=0;n<t;n++)s.append(e[n],A()),P.nextNode(),u.push({type:2,index:++i});s.append(e[t],A())}}}else if(8===s.nodeType)if(s.data===w)u.push({type:2,index:i});else{let e=-1;for(;-1!==(e=s.data.indexOf(b,e+1));)u.push({type:7,index:i}),e+=b.length-1}i++}}static createElement(e,t){const n=y.createElement("template");return n.innerHTML=e,n}}function H(e,t,n=e,s){var i,r,o,u;if(t===R)return t;let a=void 0!==s?null===(i=n._$Co)||void 0===i?void 0:i[s]:n._$Cl;const l=S(t)?void 0:t._$litDirective$;return(null==a?void 0:a.constructor)!==l&&(null===(r=null==a?void 0:a._$AO)||void 0===r||r.call(a,!1),void 0===l?a=void 0:(a=new l(e),a._$AT(e,n,s)),void 0!==s?(null!==(o=(u=n)._$Co)&&void 0!==o?o:u._$Co=[])[s]=a:n._$Cl=a),void 0!==a&&(t=H(e,a._$AS(e,t.values),a,s)),t}class U{constructor(e,t){this.u=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(e){var t;const{el:{content:n},parts:s}=this._$AD,i=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:y).importNode(n,!0);P.currentNode=i;let r=P.nextNode(),o=0,u=0,a=s[0];for(;void 0!==a;){if(o===a.index){let t;2===a.type?t=new j(r,r.nextSibling,this,e):1===a.type?t=new a.ctor(r,a.name,a.strings,this,e):6===a.type&&(t=new V(r,this,e)),this.u.push(t),a=s[++u]}o!==(null==a?void 0:a.index)&&(r=P.nextNode(),o++)}return i}p(e){let t=0;for(const n of this.u)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class j{constructor(e,t,n,s){var i;this.type=2,this._$AH=L,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=s,this._$Cm=null===(i=null==s?void 0:s.isConnected)||void 0===i||i}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cm}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=H(this,e,t),S(e)?e===L||null==e||""===e?(this._$AH!==L&&this._$AR(),this._$AH=L):e!==this._$AH&&e!==R&&this.g(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>D(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]))(e)?this.k(e):this.g(e)}O(e,t=this._$AB){return this._$AA.parentNode.insertBefore(e,t)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}g(e){this._$AH!==L&&S(this._$AH)?this._$AA.nextSibling.data=e:this.T(y.createTextNode(e)),this._$AH=e}$(e){var t;const{values:n,_$litType$:s}=e,i="number"==typeof s?this._$AC(e):(void 0===s.el&&(s.el=I.createElement(s.h,this.options)),s);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===i)this._$AH.p(n);else{const e=new U(i,this),t=e.v(this.options);e.p(n),this.T(t),this._$AH=e}}_$AC(e){let t=B.get(e.strings);return void 0===t&&B.set(e.strings,t=new I(e)),t}k(e){D(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,s=0;for(const i of e)s===t.length?t.push(n=new j(this.O(A()),this.O(A()),this,this.options)):n=t[s],n._$AI(i),s++;s<t.length&&(this._$AR(n&&n._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cm=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class q{constructor(e,t,n,s,i){this.type=1,this._$AH=L,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=L}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,n,s){const i=this.strings;let r=!1;if(void 0===i)e=H(this,e,t,0),r=!S(e)||e!==this._$AH&&e!==R,r&&(this._$AH=e);else{const s=e;let o,u;for(e=i[0],o=0;o<i.length-1;o++)u=H(this,s[n+o],t,o),u===R&&(u=this._$AH[o]),r||(r=!S(u)||u!==this._$AH[o]),u===L?e=L:e!==L&&(e+=(null!=u?u:"")+i[o+1]),this._$AH[o]=u}r&&!s&&this.j(e)}j(e){e===L?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class X extends q{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===L?void 0:e}}const W=v?v.emptyScript:"";class Y extends q{constructor(){super(...arguments),this.type=4}j(e){e&&e!==L?this.element.setAttribute(this.name,W):this.element.removeAttribute(this.name)}}class z extends q{constructor(e,t,n,s,i){super(e,t,n,s,i),this.type=5}_$AI(e,t=this){var n;if((e=null!==(n=H(this,e,t,0))&&void 0!==n?n:L)===R)return;const s=this._$AH,i=e===L&&s!==L||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,r=e!==L&&(s===L||i);i&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==n?n:this.element,e):this._$AH.handleEvent(e)}}class V{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){H(this,e)}}const G=m.litHtmlPolyfillSupport;null==G||G(I,j),(null!==(g=m.litHtmlVersions)&&void 0!==g?g:m.litHtmlVersions=[]).push("2.4.0");const Z=(e,t,n)=>{var s,i;const r=null!==(s=null==n?void 0:n.renderBefore)&&void 0!==s?s:t;let o=r._$litPart$;if(void 0===o){const e=null!==(i=null==n?void 0:n.renderBefore)&&void 0!==i?i:null;r._$litPart$=o=new j(t.insertBefore(A(),e),e,void 0,null!=n?n:{})}return o._$AI(e),o
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */};var K,J;class Q extends p{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const n=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=n.firstChild),n}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Z(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!1)}render(){return R}}Q.finalized=!0,Q._$litElement$=!0,null===(K=globalThis.litElementHydrateSupport)||void 0===K||K.call(globalThis,{LitElement:Q});const ee=globalThis.litElementPolyfillSupport;null==ee||ee({LitElement:Q}),(null!==(J=globalThis.litElementVersions)&&void 0!==J?J:globalThis.litElementVersions=[]).push("3.2.2");class te extends Q{createRenderRoot(){return this}connectedCallback(){this.__initchildnodes||(this.__initchildnodes=!0,this.initialChildNodes(Array.from(this.childNodes)),function(e,t=0){const n=e.childNodes;let s=n.length;for(;s>t;)e.removeChild(n[--s])}(this)),super.connectedCallback()}initialChildNodes(e){this.__children=e}}const ne=new Map,se=[],ie=se.map,re=se.some,oe=se.hasOwnProperty,ue=/^((?:@[^/@]+\/)?[^/@]+)(?:@([^/]+))?(?:\/(.*))?$/,ae=/^\d+\.\d+\.\d+(-[\w-.+]+)?$/,le=/(?:\.[^/]*|\/)$/;class ce extends Error{constructor(e){super(e)}}function de(e){const t=ue.exec(e);return t&&{name:t[1],version:t[2],path:t[3]}}function he(e="https://cdn.jsdelivr.net/npm/",t=["unpkg","jsdelivr","browser","main"]){if(!/\/$/.test(e))throw new Error("origin lacks trailing slash");function n(t){const n=`${e}${t.name}${t.version?`@${t.version}`:""}/package.json`;let s=ne.get(n);return s||ne.set(n,s=fetch(n).then((e=>{if(!e.ok)throw new ce("unable to load package.json");return e.redirected&&!ne.has(e.url)&&ne.set(e.url,s),e.json()}))),s}return async function(s,i){if(s.startsWith(e)&&(s=s.substring(e.length)),/^(\w+:)|\/\//i.test(s))return s;if(/^[.]{0,2}\//i.test(s))return new URL(s,i??location).href;if(!s.length||/^[\s._]/.test(s)||/\s$/.test(s))throw new ce("illegal name");const r=de(s);if(!r)return`${e}${s}`;if(!r.version&&null!=i&&i.startsWith(e)){const t=await n(de(i.substring(e.length)));r.version=t.dependencies&&t.dependencies[r.name]||t.peerDependencies&&t.peerDependencies[r.name]}if(r.path&&!le.test(r.path)&&(r.path+=".js"),r.path&&r.version&&ae.test(r.version))return`${e}${r.name}@${r.version}/${r.path}`;const o=await n(r);return`${e}${o.name}@${o.version}/${r.path||function(e){for(const n of t){let t=e[n];if("string"==typeof t)return t.startsWith("./")&&(t=t.slice(2)),le.test(t)?t:`${t}.js`}}(o)||"index.js"}`}}ce.prototype.name=ce.name;var fe=pe(he());function pe(e){const t=new Map,n=i(null);function s(e){if("string"!=typeof e)return e;let n=t.get(e);return n||t.set(e,n=new Promise(((t,n)=>{const s=document.createElement("script");s.onload=()=>{try{t(se.pop()(i(e)))}catch(e){n(new ce("invalid module"))}s.remove()},s.onerror=()=>{n(new ce("unable to load module")),s.remove()},s.async=!0,s.src=e,window.define=_e,document.head.appendChild(s)}))),n}function i(t){return n=>Promise.resolve(e(n,t)).then(s)}function r(e){return arguments.length>1?Promise.all(ie.call(arguments,n)).then(ge):n(e)}return r.alias=function(t){return pe(((n,s)=>n in t&&(s=null,"string"!=typeof(n=t[n]))?n:e(n,s)))},r.resolve=e,r}function ge(e){const t={};for(const n of e)for(const e in n)oe.call(n,e)&&(null==n[e]?Object.defineProperty(t,e,{get:me(n,e)}):t[e]=n[e]);return t}function me(e,t){return()=>e[t]}function ve(e){return"exports"===(e+="")||"module"===e}function _e(e,t,n){const s=arguments.length;s<2?(n=e,t=[]):s<3&&(n=t,t="string"==typeof e?[]:e),se.push(re.call(t,ve)?e=>{const s={},i={exports:s};return Promise.all(ie.call(t,(t=>"exports"===(t+="")?s:"module"===t?i:e(t)))).then((e=>(n.apply(null,e),i.exports)))}:e=>Promise.all(ie.call(t,e)).then((e=>"function"==typeof n?n.apply(null,e):n)))}_e.amd={};const be=Symbol("dependencies"),we=Symbol("load"),Ee=Promise.resolve(!0),ye=new Map;function Ae(e){let t="undefined"!=typeof HTMLElement&&e instanceof HTMLElement?e.constructor:e;for(;t&&!Object.hasOwn(t,"dependencies");)if(t=Object.getPrototypeOf(t),t&&"HTMLElement"===t.name)return null;return t}function Se(e){const t=Ae(e);if(!t)return Ee;const n=t[be]||(t[be]={});if(n[we])return n[we];const s={main:[],css:[]},i=t.dependencies;return i.forEach((({name:t,version:n,main:i,css:r})=>{const o=function(e,t){return n=>`https://cdn.jsdelivr.net/npm/${e}@${t}/${n}`}(t,n),u=o(i),a=o(r),l=ye.get(u)||fe(u);ye.set(u,l),s.main.push(l),r&&!ye.has(a)&&(ye.set(a,!0),s.css.push(function(e,t=globalThis.document){return new Promise((function(n,s){const i=t.createElement("link");i.rel="stylesheet",i.href=e,i.onerror=s,i.onload=n,t.head.appendChild(i)}))}(a,e.ownerDocument)))})),n[we]=Promise.all(s.main.concat(s.css)).then((e=>{const n=i.reduce(((t,n,s)=>(t[n.name]=e[s],t)),{});!function(e,t){const n=Ae(e);if(n){const e=n[be]||(n[be]={});for(const n in t)e[n]=t[n];e[we]=Ee}}(t,n)}))}class De extends te{getDependency(e){return function(e,t){return Ae(e)?.[be]?.[t]}(this,e)}shouldUpdate(){return!!function(e){const t=Ae(e);return!t||t[be]?.[we]===Ee}(this)||(Se(this).then((()=>{this.requestUpdate()})),!1)}}function xe(e,t,n){const s=t.getBoundingClientRect(),i=e.getBoundingClientRect(),r=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=document.createElementNS("http://www.w3.org/2000/svg","line"),u=document.createElementNS("http://www.w3.org/2000/svg","circle");return u.setAttribute("cx",e.offsetWidth/2),u.setAttribute("cy",i.y-s.y-e.offsetHeight),u.setAttribute("r",2),o.setAttribute("stroke","black"),o.setAttribute("stroke-width","1px"),o.setAttribute("x1",e.offsetWidth/2),o.setAttribute("y1",i.y-s.y-e.offsetHeight),o.setAttribute("x2",s.x-i.x+t.offsetWidth/2),o.setAttribute("y2",n?6:4),r.setAttribute("style",`display:inline-block;position:absolute;\n    transform:translate(-${s.x-i.x+t.offsetWidth-4}px,\n    ${i.y-s.y-t.offsetHeight/2}px);\n    width:${s.x-i.x+t.offsetWidth}px;\n    height:${i.y-s.y-e.offsetHeight+3}px;`),r.appendChild(o),r.appendChild(u),r}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Fe=2;class Ce{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this._$Ct=e,this._$AM=t,this._$Ci=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class Te extends Ce{constructor(e){if(super(e),this.it=L,e.type!==Fe)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===L||null==e)return this._t=void 0,this.it=e;if(e===R)return e;if("string"!=typeof e)throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}}Te.directiveName="unsafeHTML",Te.resultType=1;const Oe=(e=>(...t)=>({_$litDirective$:e,values:t}))(Te);function Ne(e){let t=[...e.querySelectorAll(".sticky")].map((t=>({sticky:t,inMargin:t.classList.contains("margin"),end:e.querySelector(t.getAttribute("sticky-through"))||e.querySelector(t.getAttribute("sticky-until")),untilBottom:null!=t.getAttribute("sticky-through")})));for(const{sticky:e}of t.filter((({end:e})=>!e)))console.log(e,"Could not find sticky anchor "+(e.getAttribute("sticky-through")||e.getAttribute("sticky-until"))),e.classList.remove("sticky");t=t.filter((({end:e})=>e));const n=[],s=[];for(const e of document.querySelectorAll("table-of-contents a")){const t=document.getElementById(e.hash.slice(1));if(t){const i=[e.parentNode];let r;do{if(r=i[i.length-1].parentNode.closest("li"),!r)break;i.push(r)}while(r);e.parents=i,n.push(e),s.push(t)}else e.outerHTML=e.innerHTML}s.reverse();let i=-1,r=null;window.addEventListener("scroll",(()=>{!function(){let e=[];const n=!window.matchMedia("(max-width: 1100px)").matches;for(const{sticky:s,inMargin:i,end:r,untilBottom:o}of t){if(!r)continue;const t=s.getBoundingClientRect(),u=t.top+window.scrollY-+s.style.transform.slice("translateY(".length,-"px)".length);let a=r.offsetTop;o&&(a+=r.offsetHeight);let l=a-(u+t.height);l=Math.min(0,l);let c=u+l,d=c+t.height;for(const[r,o,h]of e){if(n&&i!=h||d<=r||c>=o)continue;let e=Math.max(0,o+t.height-a);l=o-u-e,c=o-e,d=c+t.height,s.style.setProperty("z-index",1)}e.push([c,d,i]),s.style.setProperty("transform",`translateY(${l}px)`)}}(),function(){const e=s.length-s.findIndex((e=>window.scrollY>=e.offsetTop-10))-1;if(e!==i){if(r){r.classList.remove("active");for(const e of document.querySelectorAll(".active-parent"))e.classList.remove("active-parent")}if(i=e,n[e]){r=n[e].parentElement,r.classList.add("active");for(const t of n[e].parents)t.classList.add("active-parent")}}}()}),{passive:!0})}const{getPrototypeOf:ke,getOwnPropertyDescriptors:$e}=Object;ke({});var Re={},Le={};function Be(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function Pe(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var s in e)s in t||n.push(t[s]=s)})),n}function Me(e,t){var n=e+"",s=n.length;return s<t?new Array(t-s+1).join(0)+n:n}function Ie(e){var t,n=e.getUTCHours(),s=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+Me(-t,6):t>9999?"+"+Me(t,6):Me(t,4))+"-"+Me(e.getUTCMonth()+1,2)+"-"+Me(e.getUTCDate(),2)+(r?"T"+Me(n,2)+":"+Me(s,2)+":"+Me(i,2)+"."+Me(r,3)+"Z":i?"T"+Me(n,2)+":"+Me(s,2)+":"+Me(i,2)+"Z":s||n?"T"+Me(n,2)+":"+Me(s,2)+"Z":"")}function He(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function s(e,t){var s,i=[],r=e.length,o=0,u=0,a=r<=0,l=!1;function c(){if(a)return Le;if(l)return l=!1,Re;var t,s,i=o;if(34===e.charCodeAt(i)){for(;o++<r&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=r?a=!0:10===(s=e.charCodeAt(o++))?l=!0:13===s&&(l=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<r;){if(10===(s=e.charCodeAt(t=o++)))l=!0;else if(13===s)l=!0,10===e.charCodeAt(o)&&++o;else if(s!==n)continue;return e.slice(i,t)}return a=!0,e.slice(i,r)}for(10===e.charCodeAt(r-1)&&--r,13===e.charCodeAt(r-1)&&--r;(s=c())!==Le;){for(var d=[];s!==Re&&s!==Le;)d.push(s),s=c();t&&null==(d=t(d,u++))||i.push(d)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function r(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?Ie(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,r=s(e,(function(e,s){if(n)return n(e,s-1);i=e,n=t?function(e,t){var n=Be(e);return function(s,i){return t(n(s),i,e)}}(e,t):Be(e)}));return r.columns=i||[],r},parseRows:s,format:function(t,n){return null==n&&(n=Pe(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=Pe(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(r).join("\n")},formatRow:r,formatValue:o}}var Ue=He(","),je=Ue.parse,qe=Ue.parseRows,Xe=He("\t"),We=Xe.parse,Ye=Xe.parseRows;function ze(e){for(var t in e){var n,s,i=e[t].trim();if(i)if("true"===i)i=!0;else if("false"===i)i=!1;else if("NaN"===i)i=NaN;else if(isNaN(n=+i)){if(!(s=i.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;Ve&&s[4]&&!s[7]&&(i=i.replace(/-/g,"/").replace(/T/," ")),i=new Date(i)}else i=n;else i=null;e[t]=i}return e}const Ve=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function Ge(e,t,n){return{resolve:(s=n)=>`${e}@${t}/${s}`}}const Ze=Ge("d3","7.6.1","dist/d3.min.js"),Ke=Ge("@observablehq/inputs","0.10.4","dist/inputs.min.js"),Je=Ge("@observablehq/plot","0.6.0","dist/plot.umd.min.js"),Qe=Ge("@observablehq/graphviz","0.2.1","dist/graphviz.min.js"),et=Ge("@observablehq/highlight.js","2.0.0","highlight.min.js"),tt=Ge("@observablehq/katex","0.11.1","dist/katex.min.js"),nt=Ge("lodash","4.17.21","lodash.min.js"),st=Ge("htl","0.3.1","dist/htl.min.js"),it=Ge("jszip","3.10.0","dist/jszip.min.js"),rt=Ge("marked","0.3.12","marked.min.js"),ot=Ge("sql.js","1.7.0","dist/sql-wasm.js"),ut=Ge("vega","5.22.1","build/vega.min.js"),at=Ge("vega-lite","5.5.0","build/vega-lite.min.js"),lt=Ge("vega-lite-api","5.0.0","build/vega-lite-api.min.js"),ct=Ge("apache-arrow","4.0.1","Arrow.es2015.min.js"),dt=Ge("arquero","4.8.8","dist/arquero.min.js"),ht=Ge("topojson-client","3.1.0","dist/topojson-client.min.js"),ft=Ge("exceljs","4.3.0","dist/exceljs.min.js"),pt=Ge("mermaid","9.1.6","dist/mermaid.min.js"),gt=Ge("leaflet","1.8.0","dist/leaflet.js");let mt=fe;async function vt(e){const[t,n]=await Promise.all([e(ot.resolve()),e.resolve(ot.resolve("dist/"))]);return t({locateFile:e=>`${n}${e}`})}class _t{constructor(e){Object.defineProperties(this,{_db:{value:e}})}static async open(e){const[t,n]=await Promise.all([vt(mt),Promise.resolve(e).then(wt)]);return new _t(new t.Database(n))}async query(e,t){return await async function(e,t,n){const[s]=await e.exec(t,n);if(!s)return[];const{columns:i,values:r}=s,o=r.map((e=>Object.fromEntries(e.map(((e,t)=>[i[t],e])))));return o.columns=i,o}(this._db,e,t)}async queryRow(e,t){return(await this.query(e,t))[0]||null}async explain(e,t){return Et("pre",{className:"observablehq--inspect"},[yt((await this.query(`EXPLAIN QUERY PLAN ${e}`,t)).map((e=>e.detail)).join("\n"))])}async describeTables({schema:e}={}){return this.query(`SELECT NULLIF(schema, 'main') AS schema, name FROM pragma_table_list() WHERE type = 'table'${null==e?"":" AND schema = ?"} AND name NOT LIKE 'sqlite_%'`,null==e?[]:[e])}async describeColumns({schema:e,table:t}={}){if(null==t)throw new Error("missing table");const n=await this.query(`SELECT name, type, "notnull" FROM pragma_table_info(?${null==e?"":", ?"}) ORDER BY cid`,null==e?[t]:[t,e]);if(!n.length)throw new Error(`table not found: ${t}`);return n.map((({name:e,type:t,notnull:n})=>({name:e,type:bt(t),databaseType:t,nullable:!n})))}async describe(e){const t=await(void 0===e?this.query("SELECT name FROM sqlite_master WHERE type = 'table'"):this.query("SELECT * FROM pragma_table_info(?)",[e]));if(!t.length)throw new Error("Not found");const{columns:n}=t;return Et("table",{value:t},[Et("thead",[Et("tr",n.map((e=>Et("th",[yt(e)]))))]),Et("tbody",t.map((e=>Et("tr",n.map((t=>Et("td",[yt(e[t])])))))))])}async sql(){return this.query(...this.queryTag.apply(this,arguments))}queryTag(e,...t){return[e.join("?"),t]}}function bt(e){switch(e){case"NULL":return"null";case"INT":case"INTEGER":case"TINYINT":case"SMALLINT":case"MEDIUMINT":case"BIGINT":case"UNSIGNED BIG INT":case"INT2":case"INT8":return"integer";case"TEXT":case"CLOB":case"DATE":case"DATETIME":return"string";case"REAL":case"DOUBLE":case"DOUBLE PRECISION":case"FLOAT":case"NUMERIC":return"number";case"BLOB":return"buffer";default:return/^(?:(?:(?:VARYING|NATIVE) )?CHARACTER|(?:N|VAR|NVAR)CHAR)\(/.test(e)?"string":/^(?:DECIMAL|NUMERIC)\(/.test(e)?"number":"other"}}function wt(e){return"string"==typeof e?fetch(e).then(wt):e instanceof Response||e instanceof Blob?e.arrayBuffer().then(wt):e instanceof ArrayBuffer?new Uint8Array(e):e}function Et(e,t,n){2===arguments.length&&(n=t,t=void 0);const s=document.createElement(e);if(void 0!==t)for(const e in t)s[e]=t[e];if(void 0!==n)for(const e of n)s.appendChild(e);return s}function yt(e){return document.createTextNode(e)}Object.defineProperty(_t.prototype,"dialect",{value:"sqlite"});class At{constructor(e){Object.defineProperties(this,{_:{value:e},sheetNames:{value:e.worksheets.map((e=>e.name)),enumerable:!0}})}sheet(e,t){const n="number"==typeof e?this.sheetNames[e]:this.sheetNames.includes(e+="")?e:null;if(null==n)throw new Error(`Sheet not found: ${e}`);return function(e,{range:t,headers:n}={}){let[[s,i],[r,o]]=function(e=":",{columnCount:t,rowCount:n}){if(!(e+="").match(/^[A-Z]*\d*:[A-Z]*\d*$/))throw new Error("Malformed range specifier");const[[s=0,i=0],[r=t-1,o=n-1]]=e.split(":").map(Ft);return[[s,i],[r,o]]}(t,e);const u=n?e._rows[i++]:null;let a=new Set(["#"]);for(let e=s;e<=r;e++){const t=u?St(u.findCell(e+1)):null;let n=t&&t+""||xt(e);for(;a.has(n);)n+="_";a.add(n)}a=new Array(s).concat(Array.from(a));const l=new Array(o-i+1);for(let t=i;t<=o;t++){const n=l[t-i]=Object.create(null,{"#":{value:t+1}}),o=e.getRow(t+1);if(o.hasValues)for(let e=s;e<=r;e++){const t=St(o.findCell(e+1));null!=t&&(n[a[e+1]]=t)}}return l.columns=a.filter((()=>!0)),l}(this._.getWorksheet(n),t)}}function St(e){if(!e)return;const{value:t}=e;if(t&&"object"==typeof t&&!(t instanceof Date)){if(t.formula||t.sharedFormula)return t.result&&t.result.error?NaN:t.result;if(t.richText)return Dt(t);if(t.text){let{text:e}=t;return e.richText&&(e=Dt(e)),t.hyperlink&&t.hyperlink!==e?`${t.hyperlink} ${e}`:e}return t}return t}function Dt(e){return e.richText.map((e=>e.text)).join("")}function xt(e){let t="";e++;do{t=String.fromCharCode(64+(e%26||26))+t}while(e=Math.floor((e-1)/26));return t}function Ft(e){const[,t,n]=e.match(/^([A-Z]*)(\d*)$/);let s=0;if(t)for(let e=0;e<t.length;e++)s+=Math.pow(26,t.length-e-1)*(t.charCodeAt(e)-64);return[s?s-1:void 0,n?+n-1:void 0]}async function Ct(e){const t=await fetch(await e.url());if(!t.ok)throw new Error(`Unable to load file: ${e.name}`);return t}async function Tt(e,t,{array:n=!1,typed:s=!1}={}){const i=await e.text();return("\t"===t?n?Ye:We:n?qe:je)(i,s&&ze)}class Ot{constructor(e,t){Object.defineProperty(this,"name",{value:e,enumerable:!0}),void 0!==t&&Object.defineProperty(this,"mimeType",{value:t+"",enumerable:!0})}async blob(){return(await Ct(this)).blob()}async arrayBuffer(){return(await Ct(this)).arrayBuffer()}async text(){return(await Ct(this)).text()}async json(){return(await Ct(this)).json()}async stream(){return(await Ct(this)).body}async csv(e){return Tt(this,",",e)}async tsv(e){return Tt(this,"\t",e)}async image(e){const t=await this.url();return new Promise(((n,s)=>{const i=new Image;new URL(t,document.baseURI).origin!==new URL(location).origin&&(i.crossOrigin="anonymous"),Object.assign(i,e),i.onload=()=>n(i),i.onerror=()=>s(new Error(`Unable to load file: ${this.name}`)),i.src=t}))}async arrow(){const[e,t]=await Promise.all([mt(ct.resolve()),Ct(this)]);return e.Table.from(t)}async sqlite(){return _t.open(Ct(this))}async zip(){const[e,t]=await Promise.all([mt(it.resolve()),this.arrayBuffer()]);return new $t(await e.loadAsync(t))}async xml(e="application/xml"){return(new DOMParser).parseFromString(await this.text(),e)}async html(){return this.xml("text/html")}async xlsx(){const[e,t]=await Promise.all([mt(ft.resolve()),this.arrayBuffer()]);return new At(await(new e.Workbook).xlsx.load(t))}}class Nt extends Ot{constructor(e,t,n){super(t,n),Object.defineProperty(this,"_url",{value:e})}async url(){return await this._url+""}}function kt(e){throw new Error(`File not found: ${e}`)}class $t{constructor(e){Object.defineProperty(this,"_",{value:e}),this.filenames=Object.keys(e.files).filter((t=>!e.files[t].dir))}file(e){const t=this._.file(e+="");if(!t||t.dir)throw new Error(`file not found: ${e}`);return new Rt(t)}}class Rt extends Ot{constructor(e){super(e.name),Object.defineProperty(this,"_",{value:e}),Object.defineProperty(this,"_url",{writable:!0})}async url(){return this._url||(this._url=this.blob().then(URL.createObjectURL))}async blob(){return this._.async("blob")}async arrayBuffer(){return this._.async("arraybuffer")}async text(){return this._.async("text")}async json(){return JSON.parse(await this.text())}}var Lt={math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var Bt=0;function Pt(e){return new Mt("O-"+(null==e?"":e+"-")+ ++Bt)}function Mt(e){this.id=e,this.href=new URL(`#${e}`,location)+""}Mt.prototype.toString=function(){return"url("+this.href+")"};var It={canvas:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},context2d:function(e,t,n){null==n&&(n=devicePixelRatio);var s=document.createElement("canvas");s.width=e*n,s.height=t*n,s.style.width=e+"px";var i=s.getContext("2d");return i.scale(n,n),i},download:function(e,t="untitled",n="Save"){const s=document.createElement("a"),i=s.appendChild(document.createElement("button"));async function r(){await new Promise(requestAnimationFrame),URL.revokeObjectURL(s.href),s.removeAttribute("href"),i.textContent=n,i.disabled=!1}return i.textContent=n,s.download=t,s.onclick=async t=>{if(i.disabled=!0,s.href)return r();i.textContent="Saving…";try{const t=await("function"==typeof e?e():e);i.textContent="Download",s.href=URL.createObjectURL(t)}catch(e){i.textContent=n}if(t.eventPhase)return r();i.disabled=!1},s},element:function(e,t){var n,s=e+="",i=s.indexOf(":");i>=0&&"xmlns"!==(s=e.slice(0,i))&&(e=e.slice(i+1));var r=Lt.hasOwnProperty(s)?document.createElementNS(Lt[s],e):document.createElement(e);if(t)for(var o in t)i=(s=o).indexOf(":"),n=t[o],i>=0&&"xmlns"!==(s=o.slice(0,i))&&(o=o.slice(i+1)),Lt.hasOwnProperty(s)?r.setAttributeNS(Lt[s],o,n):r.setAttribute(o,n);return r},input:function(e){var t=document.createElement("input");return null!=e&&(t.type=e),t},range:function(e,t,n){1===arguments.length&&(t=e,e=null);var s=document.createElement("input");return s.min=e=null==e?0:+e,s.max=t=null==t?1:+t,s.step=null==n?"any":n=+n,s.type="range",s},select:function(e){var t=document.createElement("select");return Array.prototype.forEach.call(e,(function(e){var n=document.createElement("option");n.value=n.textContent=e,t.appendChild(n)})),t},svg:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("viewBox",[0,0,e,t]),n.setAttribute("width",e),n.setAttribute("height",t),n},text:function(e){return document.createTextNode(e)},uid:Pt};var Ht={buffer:function(e){return new Promise((function(t,n){var s=new FileReader;s.onload=function(){t(s.result)},s.onerror=n,s.readAsArrayBuffer(e)}))},text:function(e){return new Promise((function(t,n){var s=new FileReader;s.onload=function(){t(s.result)},s.onerror=n,s.readAsText(e)}))},url:function(e){return new Promise((function(t,n){var s=new FileReader;s.onload=function(){t(s.result)},s.onerror=n,s.readAsDataURL(e)}))}};function Ut(){return this}function jt(e,t){let n=!1;if("function"!=typeof t)throw new Error("dispose is not a function");return{[Symbol.iterator]:Ut,next:()=>n?{done:!0}:(n=!0,{done:!1,value:e}),return:()=>(n=!0,t(e),{done:!0}),throw:()=>({done:n=!0})}}function qt(e){let t,n,s=!1;const i=e((function(e){n?(n(e),n=null):s=!0;return t=e}));if(null!=i&&"function"!=typeof i)throw new Error("function"==typeof i.then?"async initializers are not supported":"initializer returned something, but not a dispose function");return{[Symbol.iterator]:Ut,throw:()=>({done:!0}),return:()=>(null!=i&&i(),{done:!0}),next:function(){return{done:!1,value:s?(s=!1,Promise.resolve(t)):new Promise((e=>n=e))}}}}function Xt(e){switch(e.type){case"range":case"number":return e.valueAsNumber;case"date":return e.valueAsDate;case"checkbox":return e.checked;case"file":return e.multiple?e.files:e.files[0];case"select-multiple":return Array.from(e.selectedOptions,(e=>e.value));default:return e.value}}var Wt={disposable:jt,filter:function*(e,t){for(var n,s=-1;!(n=e.next()).done;)t(n.value,++s)&&(yield n.value)},input:function(e){return qt((function(t){var n=function(e){switch(e.type){case"button":case"submit":case"checkbox":return"click";case"file":return"change";default:return"input"}}(e),s=Xt(e);function i(){t(Xt(e))}return e.addEventListener(n,i),void 0!==s&&t(s),function(){e.removeEventListener(n,i)}}))},map:function*(e,t){for(var n,s=-1;!(n=e.next()).done;)yield t(n.value,++s)},observe:qt,queue:function(e){let t;const n=[],s=e((function(e){n.push(e),t&&(t(n.shift()),t=null);return e}));if(null!=s&&"function"!=typeof s)throw new Error("function"==typeof s.then?"async initializers are not supported":"initializer returned something, but not a dispose function");return{[Symbol.iterator]:Ut,throw:()=>({done:!0}),return:()=>(null!=s&&s(),{done:!0}),next:function(){return{done:!1,value:n.length?Promise.resolve(n.shift()):new Promise((e=>t=e))}}}},range:function*(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var s=-1,i=0|Math.max(0,Math.ceil((t-e)/n));++s<i;)yield e+s*n},valueAt:function(e,t){if(!(!isFinite(t=+t)||t<0||t!=t|0))for(var n,s=-1;!(n=e.next()).done;)if(++s===t)return n.value},worker:function(e){const t=URL.createObjectURL(new Blob([e],{type:"text/javascript"})),n=new Worker(t);return jt(n,(()=>{n.terminate(),URL.revokeObjectURL(t)}))}};function Yt(e,t){return function(n){var s,i,r,o,u,a,l,c,d=n[0],h=[],f=null,p=-1;for(u=1,a=arguments.length;u<a;++u){if((s=arguments[u])instanceof Node)h[++p]=s,d+="\x3c!--o:"+p+"--\x3e";else if(Array.isArray(s)){for(l=0,c=s.length;l<c;++l)(i=s[l])instanceof Node?(null===f&&(h[++p]=f=document.createDocumentFragment(),d+="\x3c!--o:"+p+"--\x3e"),f.appendChild(i)):(f=null,d+=i);f=null}else d+=s;d+=n[u]}if(f=e(d),++p>0){for(r=new Array(p),o=document.createTreeWalker(f,NodeFilter.SHOW_COMMENT,null,!1);o.nextNode();)i=o.currentNode,/^o:/.test(i.nodeValue)&&(r[+i.nodeValue.slice(2)]=i);for(u=0;u<p;++u)(i=r[u])&&i.parentNode.replaceChild(h[u],i)}return 1===f.childNodes.length?f.removeChild(f.firstChild):11===f.nodeType?((i=t()).appendChild(f),i):f}}var zt=Yt((function(e){var t=document.createElement("template");return t.innerHTML=e.trim(),document.importNode(t.content,!0)}),(function(){return document.createElement("span")}));function Vt(e){let t;Object.defineProperties(this,{generator:{value:qt((e=>{t=e}))},value:{get:()=>e,set:n=>t(e=n)}}),void 0!==e&&t(e)}function*Gt(){for(;;)yield Date.now()}var Zt=new Map;function Kt(e,t){var n;return(n=Zt.get(e=+e))?n.then((()=>t)):(n=Date.now())>=e?Promise.resolve(t):function(e,t){var n=new Promise((function(n){Zt.delete(t);var s=t-e;if(!(s>0))throw new Error("invalid time");if(s>2147483647)throw new Error("too long to wait");setTimeout(n,s)}));return Zt.set(t,n),n}(n,e).then((()=>t))}var Jt={delay:function(e,t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))},tick:function(e,t){return Kt(Math.ceil((Date.now()+1)/e)*e,t)},when:Kt};function Qt(e,t){if(/^(\w+:)|\/\//i.test(e))return e;if(/^[.]{0,2}\//i.test(e))return new URL(e,t??location).href;if(!e.length||/^[\s._]/.test(e)||/\s$/.test(e))throw new Error("illegal name");return"https://unpkg.com/"+e}var en=Yt((function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.innerHTML=e.trim(),t}),(function(){return document.createElementNS("http://www.w3.org/2000/svg","g")})),tn=String.raw;function nn(e){return new Promise((function(t,n){var s=document.createElement("link");s.rel="stylesheet",s.href=e,s.onerror=n,s.onload=t,document.head.appendChild(s)}))}function sn(){return qt((function(e){var t=e(document.body.clientWidth);function n(){var n=document.body.clientWidth;n!==t&&e(t=n)}return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}))}const rn=Object.assign((async(e,t,n)=>{const s=function(e,t){const n=t&&"function"==typeof t.escape?t.escape:e=>e,{select:s,from:i,filter:r,sort:o,slice:u}=e;if(null===i.table||null===s.columns||s.columns&&0===s.columns.length)return;const a=s.columns.map((e=>`t.${n(e)}`)),l=[[`SELECT ${a} FROM ${un(i.table,n)} t`]];for(let e=0;e<r.length;++e)an(e?"\nAND ":"\nWHERE ",l),cn(r[e],l);for(let e=0;e<o.length;++e)an(e?", ":"\nORDER BY ",l),ln(o[e],l);null===u.to&&null===u.from||an("\nLIMIT "+(null!==u.to?u.to-(u.from||0):1e9),l);null!==u.from&&an(` OFFSET ${u.from}`,l);return l}(t,await e);return s?on(await e,s,n):null}),{sql:(e,t)=>async function(){return on(e,arguments,t)}});async function on(e,t,n){if(e){if("function"==typeof e.queryTag){const s=new AbortController,i={signal:s.signal};if(n.then((()=>s.abort("invalidated"))),"function"==typeof e.queryStream)return async function*(e){const t=await e,n=[];n.done=!1,n.error=null,n.schema=t.schema;try{const e=t.readRows();do{const t=await e.next();if(t.done)n.done=!0;else for(const e of t.value)n.push(e);yield n}while(!n.done)}catch(e){n.error=e,yield n}}(e.queryStream(...e.queryTag.apply(e,t),i));if("function"==typeof e.query)return e.query(...e.queryTag.apply(e,t),i)}if("function"==typeof e.sql)return e.sql.apply(e,t);throw new Error("source does not implement query, queryStream, or sql")}}function un(e,t){if("object"==typeof e){let n="";return null!=e.database&&(n+=t(e.database)+"."),null!=e.schema&&(n+=t(e.schema)+"."),n+=t(e.table),n}return e}function an(e,t){const n=t[0];n[n.length-1]+=e}function ln({column:e,direction:t},n){an(`t.${e} ${t.toUpperCase()}`,n)}function cn({type:e,operands:t},n){if(t.length<1)throw new Error("Invalid operand length");if(1===t.length)switch(dn(t[0],n),e){case"n":return void an(" IS NULL",n);case"nn":return void an(" IS NOT NULL",n);default:throw new Error("Invalid filter operation")}if(2!==t.length||["in","nin"].includes(e)){var s;switch(dn(t[0],n),e){case"in":an(" IN (",n);break;case"nin":an(" NOT IN (",n);break;default:throw new Error("Invalid filter operation")}!function(e,t){let n=!0;for(const s of e)n?n=!1:an(",",t),t.push(s.value),t[0].push("")}(t.slice(1),n),an(")",n)}else{if(["c","nc"].includes(e)){switch(dn(t[0],n),e){case"c":an(" LIKE ",n);break;case"nc":an(" NOT LIKE ",n)}return void dn((s=t[1],{...s,value:`%${s.value}%`}),n)}switch(dn(t[0],n),e){case"eq":an(" = ",n);break;case"ne":an(" <> ",n);break;case"gt":an(" > ",n);break;case"lt":an(" < ",n);break;case"gte":an(" >= ",n);break;case"lte":an(" <= ",n);break;default:throw new Error("Invalid filter operation")}dn(t[1],n)}}function dn(e,t){"column"===e.type?an(`t.${e.value}`,t):(t.push(e.value),t[0].push(""))}var hn=Object.assign(Object.defineProperties((function(e){const t=function(e){return null==e?mt:pe(e)}(e);var n;Object.defineProperties(this,(n={FileAttachment:()=>kt,Mutable:()=>Vt,now:Gt,width:sn,dot:()=>t(Qe.resolve()),htl:()=>t(st.resolve()),html:()=>zt,md:()=>function(e){return e(rt.resolve()).then((function(t){return Yt((function(n){var s=document.createElement("div");s.innerHTML=t(n,{langPrefix:""}).trim();var i=s.querySelectorAll("pre code[class]");return i.length>0&&e(et.resolve()).then((function(t){i.forEach((function(n){function s(){t.highlightBlock(n),n.parentNode.classList.add("observablehq--md-pre")}t.getLanguage(n.className)?s():e(et.resolve("async-languages/index.js")).then((s=>{if(s.has(n.className))return e(et.resolve("async-languages/"+s.get(n.className))).then((e=>{t.registerLanguage(n.className,e)}))})).then(s,s)}))})),s}),(function(){return document.createElement("div")}))}))}(t),svg:()=>en,tex:()=>function(e){return Promise.all([e(tt.resolve()),e.resolve(tt.resolve("dist/katex.min.css")).then(nn)]).then((function(e){var t=e[0],n=s();function s(e){return function(){var n=document.createElement("div");return t.render(tn.apply(String,arguments),n,e),n.removeChild(n.firstChild)}}return n.options=s,n.block=s({displayMode:!0}),n}))}(t),_:()=>t(nt.resolve()),aq:()=>t.alias({"apache-arrow":ct.resolve()})(dt.resolve()),Arrow:()=>t(ct.resolve()),d3:()=>t(Ze.resolve()),Inputs:()=>t(Ke.resolve()).then((e=>({...e,file:e.fileOf(Ot)}))),L:()=>async function(e){const t=await e(gt.resolve());if(!t._style){const n=document.createElement("link");n.rel="stylesheet",n.href=await e.resolve(gt.resolve("dist/leaflet.css")),t._style=document.head.appendChild(n)}return t}(t),mermaid:()=>async function(e){const t=await e(pt.resolve());return t.initialize({securityLevel:"loose",theme:"neutral"}),function(){const e=document.createElement("div");return e.innerHTML=t.render(Pt().id,String.raw.apply(String,arguments)),e.removeChild(e.firstChild)}}(t),Plot:()=>t(Je.resolve()),__query:()=>rn,require:()=>t,resolve:()=>Qt,SQLite:()=>vt(t),SQLiteDatabaseClient:()=>_t,topojson:()=>t(ht.resolve()),vl:()=>async function(e){const[t,n,s]=await Promise.all([ut,at,lt].map((t=>e(t.resolve()))));return s.register(t,n)}(t),aapl:()=>new Nt("https://static.observableusercontent.com/files/3ccff97fd2d93da734e76829b2b066eafdaac6a1fafdec0faf6ebc443271cfc109d29e80dd217468fcb2aff1e6bffdc73f356cc48feb657f35378e6abbbb63b9").csv({typed:!0}),alphabet:()=>new Nt("https://static.observableusercontent.com/files/75d52e6c3130b1cae83cda89305e17b50f33e7420ef205587a135e8562bcfd22e483cf4fa2fb5df6dff66f9c5d19740be1cfaf47406286e2eb6574b49ffc685d").csv({typed:!0}),cars:()=>new Nt("https://static.observableusercontent.com/files/048ec3dfd528110c0665dfa363dd28bc516ffb7247231f3ab25005036717f5c4c232a5efc7bb74bc03037155cb72b1abe85a33d86eb9f1a336196030443be4f6").csv({typed:!0}),citywages:()=>new Nt("https://static.observableusercontent.com/files/39837ec5121fcc163131dbc2fe8c1a2e0b3423a5d1e96b5ce371e2ac2e20a290d78b71a4fb08b9fa6a0107776e17fb78af313b8ea70f4cc6648fad68ddf06f7a").csv({typed:!0}),diamonds:()=>new Nt("https://static.observableusercontent.com/files/87942b1f5d061a21fa4bb8f2162db44e3ef0f7391301f867ab5ba718b225a63091af20675f0bfe7f922db097b217b377135203a7eab34651e21a8d09f4e37252").csv({typed:!0}),flare:()=>new Nt("https://static.observableusercontent.com/files/a6b0d94a7f5828fd133765a934f4c9746d2010e2f342d335923991f31b14120de96b5cb4f160d509d8dc627f0107d7f5b5070d2516f01e4c862b5b4867533000").csv({typed:!0}),industries:()=>new Nt("https://static.observableusercontent.com/files/76f13741128340cc88798c0a0b7fa5a2df8370f57554000774ab8ee9ae785ffa2903010cad670d4939af3e9c17e5e18e7e05ed2b38b848ac2fc1a0066aa0005f").csv({typed:!0}),miserables:()=>new Nt("https://static.observableusercontent.com/files/31d904f6e21d42d4963ece9c8cc4fbd75efcbdc404bf511bc79906f0a1be68b5a01e935f65123670ed04e35ca8cae3c2b943f82bf8db49c5a67c85cbb58db052").json(),olympians:()=>new Nt("https://static.observableusercontent.com/files/31ca24545a0603dce099d10ee89ee5ae72d29fa55e8fc7c9ffb5ded87ac83060d80f1d9e21f4ae8eb04c1e8940b7287d179fe8060d887fb1f055f430e210007c").csv({typed:!0}),penguins:()=>new Nt("https://static.observableusercontent.com/files/715db1223e067f00500780077febc6cebbdd90c151d3d78317c802732252052ab0e367039872ab9c77d6ef99e5f55a0724b35ddc898a1c99cb14c31a379af80a").csv({typed:!0}),weather:()=>new Nt("https://static.observableusercontent.com/files/693a46b22b33db0f042728700e0c73e836fa13d55446df89120682d55339c6db7cc9e574d3d73f24ecc9bc7eb9ac9a1e7e104a1ee52c00aab1e77eb102913c1f").csv({typed:!0}),DOM:It,Files:Ht,Generators:Wt,Promises:Jt},Object.fromEntries(Object.entries(n).map(fn))))}),{resolve:{get:()=>mt.resolve,enumerable:!0,configurable:!0},require:{get:()=>mt,set:function(e){mt=e},enumerable:!0,configurable:!0}}),{resolveFrom:he,requireFrom:pe});function fn([e,t]){return[e,{value:t,writable:!0,enumerable:!0}]}function pn(e,t){this.message=e+"",this.input=t}function gn(e){return function(){return e}}function mn(e){return e}pn.prototype=Object.create(Error.prototype),pn.prototype.name="RuntimeError",pn.prototype.constructor=pn;var vn=Array.prototype.map;function _n(){}var bn={};function wn(e,t,n){var s;n||(n=bn),Object.defineProperties(this,{_observer:{value:n,writable:!0},_definition:{value:An,writable:!0},_duplicate:{value:void 0,writable:!0},_duplicates:{value:void 0,writable:!0},_indegree:{value:NaN,writable:!0},_inputs:{value:[],writable:!0},_invalidate:{value:_n,writable:!0},_module:{value:t},_name:{value:null,writable:!0},_outputs:{value:new Set,writable:!0},_promise:{value:Promise.resolve(void 0),writable:!0},_reachable:{value:n!==bn,writable:!0},_rejector:{value:(s=this,function(e){if(e===Sn)throw e;if(e===An)throw new pn(s._name+" is not defined",s._name);if(e instanceof Error&&e.message)throw new pn(e.message,s._name);throw new pn(s._name+" could not be resolved",s._name)})},_type:{value:e},_value:{value:void 0,writable:!0},_version:{value:0,writable:!0}})}function En(e){e._module._runtime._dirty.add(e),e._outputs.add(this)}function yn(e){e._module._runtime._dirty.add(e),e._outputs.delete(this)}function An(){throw An}function Sn(){throw Sn}function Dn(e){return function(){throw new pn(e+" is defined more than once")}}function xn(e,t,n){var s=this._module._scope,i=this._module._runtime;if(this._inputs.forEach(yn,this),t.forEach(En,this),this._inputs=t,this._definition=n,this._value=void 0,n===_n?i._variables.delete(this):i._variables.add(this),e!==this._name||s.get(e)!==this){var r,o;if(this._name)if(this._outputs.size)s.delete(this._name),(o=this._module._resolve(this._name))._outputs=this._outputs,this._outputs=new Set,o._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(this)]=o}),this),o._outputs.forEach(i._updates.add,i._updates),i._dirty.add(o).add(this),s.set(this._name,o);else if((o=s.get(this._name))===this)s.delete(this._name);else{if(3!==o._type)throw new Error;o._duplicates.delete(this),this._duplicate=void 0,1===o._duplicates.size&&(o=o._duplicates.keys().next().value,r=s.get(this._name),o._outputs=r._outputs,r._outputs=new Set,o._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(r)]=o})),o._definition=o._duplicate,o._duplicate=void 0,i._dirty.add(r).add(o),i._updates.add(o),s.set(this._name,o))}if(this._outputs.size)throw new Error;e&&((o=s.get(e))?3===o._type?(this._definition=Dn(e),this._duplicate=n,o._duplicates.add(this)):2===o._type?(this._outputs=o._outputs,o._outputs=new Set,this._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(o)]=this}),this),i._dirty.add(o).add(this),s.set(e,this)):(o._duplicate=o._definition,this._duplicate=n,(r=new wn(3,this._module))._name=e,r._definition=this._definition=o._definition=Dn(e),r._outputs=o._outputs,o._outputs=new Set,r._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(o)]=r})),r._duplicates=new Set([this,o]),i._dirty.add(o).add(r),i._updates.add(o).add(r),s.set(e,r)):s.set(e,this)),this._name=e}return this._version>0&&++this._version,i._updates.add(this),i._compute(),this}function Fn(e,t=[]){Object.defineProperties(this,{_runtime:{value:e},_scope:{value:new Map},_builtins:{value:new Map([["@variable",Nn],["invalidation",kn],["visibility",$n],...t])},_source:{value:null,writable:!0}})}async function Cn(e,t){await e._compute();try{return await t._promise}catch(n){if(n===Sn)return Cn(e,t);throw n}}function Tn(e){return e._name}Object.defineProperties(wn.prototype,{_pending:{value:function(){this._observer.pending&&this._observer.pending()},writable:!0,configurable:!0},_fulfilled:{value:function(e){this._observer.fulfilled&&this._observer.fulfilled(e,this._name)},writable:!0,configurable:!0},_rejected:{value:function(e){this._observer.rejected&&this._observer.rejected(e,this._name)},writable:!0,configurable:!0},define:{value:function(e,t,n){switch(arguments.length){case 1:n=e,e=t=null;break;case 2:n=t,"string"==typeof e?t=null:(t=e,e=null)}return xn.call(this,null==e?null:e+"",null==t?[]:vn.call(t,this._module._resolve,this._module),"function"==typeof n?n:gn(n))},writable:!0,configurable:!0},delete:{value:function(){return xn.call(this,null,[],_n)},writable:!0,configurable:!0},import:{value:function(e,t,n){arguments.length<3&&(n=t,t=e);return xn.call(this,t+"",[n._resolve(e+"")],mn)},writable:!0,configurable:!0}}),Object.defineProperties(Fn.prototype,{_resolve:{value:function(e){var t,n=this._scope.get(e);if(!n)if(n=new wn(2,this),this._builtins.has(e))n.define(e,gn(this._builtins.get(e)));else if(this._runtime._builtin._scope.has(e))n.import(e,this._runtime._builtin);else{try{t=this._runtime._global(e)}catch(t){return n.define(e,function(e){return function(){throw e}}(t))}void 0===t?this._scope.set(n._name=e,n):n.define(e,gn(t))}return n},writable:!0,configurable:!0},redefine:{value:function(e){var t=this._scope.get(e);if(!t)throw new pn(e+" is not defined");if(3===t._type)throw new pn(e+" is defined more than once");return t.define.apply(t,arguments)},writable:!0,configurable:!0},define:{value:function(){var e=new wn(1,this);return e.define.apply(e,arguments)},writable:!0,configurable:!0},derive:{value:function(e,t){const n=new Map,s=new Set,i=[];function r(e){let t=n.get(e);return t||(t=new Fn(e._runtime,e._builtins),t._source=e,n.set(e,t),i.push([t,e]),s.add(e),t)}const o=r(this);for(const n of e){const{alias:e,name:s}="object"==typeof n?n:{name:n};o.import(s,e??s,t)}for(const e of s)for(const[t,n]of e._scope)if(n._definition===mn){if(e===this&&o._scope.has(t))continue;const s=n._inputs[0]._module;s._source&&r(s)}for(const[e,t]of i)for(const[s,i]of t._scope){const t=e._scope.get(s);if(!t||2===t._type)if(i._definition===mn){const t=i._inputs[0],r=t._module;e.import(t._name,s,n.get(r)||r)}else e.define(s,i._inputs.map(Tn),i._definition)}return o},writable:!0,configurable:!0},import:{value:function(){var e=new wn(1,this);return e.import.apply(e,arguments)},writable:!0,configurable:!0},value:{value:async function(e){var t=this._scope.get(e);if(!t)throw new pn(e+" is not defined");if(t._observer!==bn)return Cn(this._runtime,t);t=this.variable(!0).define([e],mn);try{return await Cn(this._runtime,t)}finally{t.delete()}},writable:!0,configurable:!0},variable:{value:function(e){return new wn(1,this,e)},writable:!0,configurable:!0},builtin:{value:function(e,t){this._builtins.set(e,t)},writable:!0,configurable:!0}});const On="function"==typeof requestAnimationFrame?requestAnimationFrame:"function"==typeof setImmediate?setImmediate:e=>setTimeout(e,0);var Nn={},kn={},$n={};function Rn(e=new hn,t=qn){var n=this.module();if(Object.defineProperties(this,{_dirty:{value:new Set},_updates:{value:new Set},_precomputes:{value:[],writable:!0},_computing:{value:null,writable:!0},_init:{value:null,writable:!0},_modules:{value:new Map},_variables:{value:new Set},_disposed:{value:!1,writable:!0},_builtin:{value:n},_global:{value:t}}),e)for(var s in e)new wn(2,n).define(s,[],e[s])}function Ln(e){const t=new Set(e._inputs);for(const n of t){if(n===e)return!0;n._inputs.forEach(t.add,t)}return!1}function Bn(e){++e._indegree}function Pn(e){--e._indegree}function Mn(e){return e._promise.catch(e._rejector)}function In(e){return new Promise((function(t){e._invalidate=t}))}function Hn(e,t){let n,s,i="function"==typeof IntersectionObserver&&t._observer&&t._observer._node,r=!i,o=_n,u=_n;return i&&(s=new IntersectionObserver((([e])=>(r=e.isIntersecting)&&(n=null,o()))),s.observe(i),e.then((()=>(s.disconnect(),s=null,u())))),function(e){return r?Promise.resolve(e):s?(n||(n=new Promise(((e,t)=>(o=e,u=t)))),n.then((()=>e))):Promise.reject()}}function Un(e){e._invalidate(),e._invalidate=_n,e._pending();const t=e._value,n=++e._version;let s=null;const i=e._promise=(e._inputs.length?Promise.all(e._inputs.map(Mn)).then((function(i){if(e._version!==n)throw Sn;for(var r=0,o=i.length;r<o;++r)switch(i[r]){case kn:i[r]=s=In(e);break;case $n:s||(s=In(e)),i[r]=Hn(s,e);break;case Nn:i[r]=e}return e._definition.apply(t,i)})):new Promise((n=>n(e._definition.call(t))))).then((function(t){if(e._version!==n)throw Sn;if(function(e){return e&&"function"==typeof e.next&&"function"==typeof e.return}(t))return(s||In(e)).then((i=t,function(){i.return()})),function(e,t,n){const s=e._module._runtime;let i;function r(e){return new Promise((e=>e(n.next(i)))).then((({done:t,value:n})=>t?void 0:Promise.resolve(n).then(e)))}function o(){const n=r((r=>{if(e._version!==t)throw Sn;return i=r,u(r,n).then((()=>s._precompute(o))),e._fulfilled(r),r}));n.catch((s=>{s!==Sn&&e._version===t&&(u(void 0,n),e._rejected(s))}))}function u(t,n){return e._value=t,e._promise=n,e._outputs.forEach(s._updates.add,s._updates),s._compute()}return r((n=>{if(e._version!==t)throw Sn;return i=n,s._precompute(o),n}))}(e,n,t);var i;return t}));i.then((t=>{e._value=t,e._fulfilled(t)}),(t=>{t!==Sn&&(e._value=void 0,e._rejected(t))}))}function jn(e,t){e._invalidate(),e._invalidate=_n,e._pending(),++e._version,e._indegree=NaN,(e._promise=Promise.reject(t)).catch(_n),e._value=void 0,e._rejected(t)}function qn(e){return window[e]}Object.defineProperties(Rn,{load:{value:function(e,t,n){if("function"==typeof t&&(n=t,t=null),"function"!=typeof n)throw new Error("invalid observer");null==t&&(t=new hn);const{modules:s,id:i}=e,r=new Map,o=new Rn(t),u=a(i);function a(e){let t=r.get(e);return t||r.set(e,t=o.module()),t}for(const e of s){const t=a(e.id);let s=0;for(const i of e.variables)i.from?t.import(i.remote,i.name,a(i.from)):t===u?t.variable(n(i,s,e.variables)).define(i.name,i.inputs,i.value):t.define(i.name,i.inputs,i.value),++s}return o},writable:!0,configurable:!0}}),Object.defineProperties(Rn.prototype,{_precompute:{value:function(e){this._precomputes.push(e),this._compute()},writable:!0,configurable:!0},_compute:{value:function(){return this._computing||(this._computing=this._computeSoon())},writable:!0,configurable:!0},_computeSoon:{value:function(){return new Promise(On).then((()=>this._disposed?void 0:this._computeNow()))},writable:!0,configurable:!0},_computeNow:{value:async function(){var e,t,n=[],s=this._precomputes;if(s.length){this._precomputes=[];for(const e of s)e();await function(e=0){let t=Promise.resolve();for(let n=0;n<e;++n)t=t.then((()=>{}));return t}(3)}(e=new Set(this._dirty)).forEach((function(t){t._inputs.forEach(e.add,e);const n=function(e){if(e._observer!==bn)return!0;var t=new Set(e._outputs);for(const e of t){if(e._observer!==bn)return!0;e._outputs.forEach(t.add,t)}return!1}(t);n>t._reachable?this._updates.add(t):n<t._reachable&&t._invalidate(),t._reachable=n}),this),(e=new Set(this._updates)).forEach((function(t){t._reachable?(t._indegree=0,t._outputs.forEach(e.add,e)):(t._indegree=NaN,e.delete(t))})),this._computing=null,this._updates.clear(),this._dirty.clear(),e.forEach((function(e){e._outputs.forEach(Bn)}));do{for(e.forEach((function(e){0===e._indegree&&n.push(e)}));t=n.pop();)Un(t),t._outputs.forEach(i),e.delete(t);e.forEach((function(t){Ln(t)&&(jn(t,new pn("circular definition")),t._outputs.forEach(Pn),e.delete(t))}))}while(e.size);function i(e){0==--e._indegree&&n.push(e)}},writable:!0,configurable:!0},dispose:{value:function(){this._computing=Promise.resolve(),this._disposed=!0,this._variables.forEach((e=>{e._invalidate(),e._version=NaN}))},writable:!0,configurable:!0},module:{value:function(e,t=_n){let n;if(void 0===e)return(n=this._init)?(this._init=null,n):new Fn(this);if(n=this._modules.get(e),n)return n;this._init=n=new Fn(this),this._modules.set(e,n);try{e(this,t)}finally{this._init=null}return n},writable:!0,configurable:!0},fileAttachments:{value:function(e){return Object.assign((t=>{const n=e(t+="");if(null==n)throw new Error(`File not found: ${t}`);if("object"==typeof n&&"url"in n){const{url:e,mimeType:s}=n;return new Nt(e,t,s)}return new Nt(n,t)}),{prototype:Nt.prototype})},writable:!0,configurable:!0}}),Rn.prototype.fileAttachments((function(e){return e}));const Xn=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","BR","DETAILS","DIALOG","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","OL","P","PRE","SECTION","TABLE","UL","TR","TH","TD","COLGROUP","COL","CAPTION","THEAD","TBODY","TFOOT"],Wn=/[\t-\r -#%-\*,-\/:;\?@\[-\]_\{\}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,Yn={NO_SUFFIX_MATCH:0,SUFFIX_MATCH:1,MISPLACED_SUFFIX:2},zn=(e,t,n,s)=>{const i=s.createRange();i.setStart(t.endContainer,t.endOffset),i.setEnd(n.endContainer,n.endOffset),Gn(i);const r=ts(e,i);return null==r?Yn.NO_SUFFIX_MATCH:0!==r.compareBoundaryPoints(Range.START_TO_START,i)?Yn.MISPLACED_SUFFIX:Yn.SUFFIX_MATCH},Vn=(e,t,n)=>{try{e.setStart(t,n+1)}catch(n){e.setStartAfter(t)}},Gn=e=>{const t=Zn(e);let n=t.nextNode();for(;!e.collapsed&&null!=n;){if(n!==e.startContainer&&e.setStart(n,0),n.textContent.length>e.startOffset){if(!n.textContent[e.startOffset].match(/\s/))return}try{e.setStart(n,e.startOffset+1)}catch(s){n=t.nextNode(),null==n?e.collapse():e.setStart(n,0)}}},Zn=e=>document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,(t=>Qn(t,e))),Kn=e=>{let t=e;for(;null!=t&&!(t instanceof HTMLElement);)t=t.parentNode;if(null!=t){const e=window.getComputedStyle(t);if("hidden"===e.visibility||"none"===e.display||0===e.height||0===e.width||0===e.opacity)return!1}return!0},Jn=(e,t)=>(null==t||t.intersectsNode(e))&&Kn(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT,Qn=(e,t)=>(null==t||t.intersectsNode(e))&&Kn(e)?e.nodeType===Node.TEXT_NODE?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT,es=(e,t)=>{const n=[];let s=[];const i=Array.from(function*(e,t){const n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:t}),s=new Set;for(;null!==us(n,s);)yield n.currentNode}(e,(e=>Jn(e,t))));for(const e of i)e.nodeType===Node.TEXT_NODE?s.push(e):e instanceof HTMLElement&&Xn.includes(e.tagName)&&s.length>0&&(n.push(s),s=[]);return s.length>0&&n.push(s),n};const ts=(e,t)=>{const n=es(t.commonAncestorContainer,t),s=os();for(const i of n){const n=ns(e,t,i,s);if(void 0!==n)return n}},ns=(e,t,n,s)=>{if(!e||!t||!(n||[]).length)return;const i=rs(((e,t,n)=>{let s="";return s=1===e.length?e[0].textContent.substring(t,n):e[0].textContent.substring(t)+e.slice(1,-1).reduce(((e,t)=>e+t.textContent),"")+e.slice(-1)[0].textContent.substring(0,n),s.replace(/[\t\n\r ]+/g," ")})(n,0,void 0)),r=rs(e);let o,u,a=n[0]===t.startNode?t.startOffset:0;for(;a<i.length;){const e=i.indexOf(r,a);if(-1===e)return;if(is(i,e,r.length,s)&&(o=ss(e,n,!1),u=ss(e+r.length,n,!0)),null!=o&&null!=u){const e=new Range;if(e.setStart(o.node,o.offset),e.setEnd(u.node,u.offset),t.compareBoundaryPoints(Range.START_TO_START,e)<=0&&t.compareBoundaryPoints(Range.END_TO_END,e)>=0)return e}a=e+1}},ss=(e,t,n)=>{let s,i=0;for(let r=0;r<t.length;r++){const o=t[r];s||(s=rs(o.data));let u=i+s.length;if(n&&(u+=1),u>e){const t=e-i;let r=Math.min(e-i,o.data.length);const u=n?s.substring(0,t):s.substring(t);let a=rs(n?o.data.substring(0,r):o.data.substring(r));const l=(n?-1:1)*(u.length>a.length?-1:1);for(;r>=0&&r<=o.data.length;){if(a.length===u.length)return{node:o,offset:r};r+=l,a=rs(n?o.data.substring(0,r):o.data.substring(r))}}if(i+=s.length,r+1<t.length){const e=rs(t[r+1].data);" "===s.slice(-1)&&" "===e.slice(0,1)&&(i-=1),s=e}}},is=(e,t,n,s)=>{if(t<0||t>=e.length||n<=0||t+n>e.length)return!1;if(s){const i=s.segment(e),r=i.containing(t);if(!r)return!1;if(r.isWordLike&&r.index!=t)return!1;const o=t+n,u=i.containing(o);if(u&&u.isWordLike&&u.index!=o)return!1}else{if(e[t].match(Wn)&&(++t,!--n))return!1;if(e[t+n-1].match(Wn)&&!--n)return!1;if(0!==t&&!e[t-1].match(Wn))return!1;if(t+n!==e.length&&!e[t+n].match(Wn))return!1}return!0},rs=e=>(e||"").normalize("NFKD").replace(/\s+/g," ").replace(/[\u0300-\u036f]/g,"").toLowerCase(),os=()=>{if(Intl.Segmenter){let e=document.documentElement.lang;return e||(e=navigator.languages),new Intl.Segmenter(e,{granularity:"word"})}},us=(e,t)=>{if(!t.has(e.currentNode)){const t=e.firstChild();if(null!==t)return t}const n=e.nextSibling();if(null!==n)return n;const s=e.parentNode();return null!==s&&t.add(s),s},as={BLOCK_ELEMENTS:Xn,BOUNDARY_CHARS:Wn,NON_BOUNDARY_CHARS:/[^\t-\r -#%-\*,-\/:;\?@\[-\]_\{\}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,acceptNodeIfVisibleInRange:Jn,normalizeString:rs,makeNewSegmenter:os,forwardTraverse:us,backwardTraverse:(e,t)=>{if(!t.has(e.currentNode)){const t=e.lastChild();if(null!==t)return t}const n=e.previousSibling();if(null!==n)return n;const s=e.parentNode();return null!==s&&t.add(s),s},makeTextNodeWalker:Zn,isNodeVisible:Kn};"undefined"!=typeof goog&&goog.declareModuleId("googleChromeLabs.textFragmentPolyfill.textFragmentUtils");let ls;const cs=0,ds=1,hs=2,fs=3,ps=4,gs=(e,t)=>{let n;vs(t);try{n=e.getRangeAt(0)}catch{return{status:ds}}Ns(n),Ls(n);const s=n.cloneRange();if(ks(n),n.collapsed)return{status:ds};let i;if(Ss(n)){const e=as.normalizeString(n.toString()),t={textStart:e};if(e.length>=20&&ys(t))return{status:cs,fragment:t};i=(new ws).setExactTextMatch(e)}else{const e=_s(n),t=bs(n);i=e&&t?(new ws).setStartAndEndSearchSpace(e,t):(new ws).setSharedSearchSpace(n.toString().trim())}const r=document.createRange();r.selectNodeContents(document.body);const o=r.cloneRange();r.setEnd(s.startContainer,s.startOffset),o.setStart(s.endContainer,s.endOffset);const u=bs(r),a=_s(o);(u||a)&&i.setPrefixAndSuffixSearchSpace(u,a),i.useSegmenter(as.makeNewSegmenter());let l=!1;do{ms(),l=i.embiggen();const e=i.tryToMakeUniqueFragment();if(null!=e)return{status:cs,fragment:e}}while(l);return{status:hs}},ms=()=>{const e=Date.now()-ls;if(e>500){const t=new Error(`Fragment generation timed out after ${e} ms.`);throw t.isTimeout=!0,t}},vs=e=>{ls=e},_s=e=>{let t=Ds(e);const n=Os(t,e.endContainer);if(!n)return;const s=new Set;e.startContainer.nodeType===Node.ELEMENT_NODE&&e.startOffset===e.startContainer.childNodes.length&&s.add(e.startContainer);const i=t,r=new Es(e,!0),o=e.cloneRange();for(;!o.collapsed&&null!=t;){if(ms(),t.contains(i)?o.setStartAfter(t):o.setStartBefore(t),r.appendNode(t),null!==r.textInBlock)return r.textInBlock;t=as.forwardTraverse(n,s)}},bs=e=>{let t=xs(e);const n=Os(t,e.startContainer);if(!n)return;const s=new Set;e.endContainer.nodeType===Node.ELEMENT_NODE&&0===e.endOffset&&s.add(e.endContainer);const i=t,r=new Es(e,!1),o=e.cloneRange();for(;!o.collapsed&&null!=t;){if(ms(),t.contains(i)?o.setEnd(t,0):o.setEndAfter(t),r.appendNode(t),null!==r.textInBlock)return r.textInBlock;t=as.backwardTraverse(n,s)}},ws=class{constructor(){this.Mode={ALL_PARTS:1,SHARED_START_AND_END:2,CONTEXT_ONLY:3},this.startOffset=null,this.endOffset=null,this.prefixOffset=null,this.suffixOffset=null,this.prefixSearchSpace="",this.backwardsPrefixSearchSpace="",this.suffixSearchSpace="",this.numIterations=0}tryToMakeUniqueFragment(){let e;if(e=this.mode===this.Mode.CONTEXT_ONLY?{textStart:this.exactTextMatch}:{textStart:this.getStartSearchSpace().substring(0,this.startOffset).trim(),textEnd:this.getEndSearchSpace().substring(this.endOffset).trim()},null!=this.prefixOffset){const t=this.getPrefixSearchSpace().substring(this.prefixOffset).trim();t&&(e.prefix=t)}if(null!=this.suffixOffset){const t=this.getSuffixSearchSpace().substring(0,this.suffixOffset).trim();t&&(e.suffix=t)}return ys(e)?e:void 0}embiggen(){let e=!0;if(this.mode===this.Mode.SHARED_START_AND_END?this.startOffset>=this.endOffset&&(e=!1):this.mode===this.Mode.ALL_PARTS?this.startOffset===this.getStartSearchSpace().length&&this.backwardsEndOffset()===this.getEndSearchSpace().length&&(e=!1):this.mode===this.Mode.CONTEXT_ONLY&&(e=!1),e){const e=this.getNumberOfRangeWordsToAdd();if(this.startOffset<this.getStartSearchSpace().length){let t=0;if(null!=this.getStartSegments())for(;t<e&&this.startOffset<this.getStartSearchSpace().length;)this.startOffset=this.getNextOffsetForwards(this.getStartSegments(),this.startOffset,this.getStartSearchSpace()),t++;else{let n=this.startOffset;do{ms();const e=this.getStartSearchSpace().substring(this.startOffset+1).search(as.BOUNDARY_CHARS);this.startOffset=-1===e?this.getStartSearchSpace().length:this.startOffset+1+e,-1!==this.getStartSearchSpace().substring(n,this.startOffset).search(as.NON_BOUNDARY_CHARS)&&(n=this.startOffset,t++)}while(this.startOffset<this.getStartSearchSpace().length&&t<e)}this.mode===this.Mode.SHARED_START_AND_END&&(this.startOffset=Math.min(this.startOffset,this.endOffset))}if(this.backwardsEndOffset()<this.getEndSearchSpace().length){let t=0;if(null!=this.getEndSegments())for(;t<e&&this.endOffset>0;)this.endOffset=this.getNextOffsetBackwards(this.getEndSegments(),this.endOffset),t++;else{let n=this.backwardsEndOffset();do{ms();const e=this.getBackwardsEndSearchSpace().substring(this.backwardsEndOffset()+1).search(as.BOUNDARY_CHARS);-1===e?this.setBackwardsEndOffset(this.getEndSearchSpace().length):this.setBackwardsEndOffset(this.backwardsEndOffset()+1+e),-1!==this.getBackwardsEndSearchSpace().substring(n,this.backwardsEndOffset()).search(as.NON_BOUNDARY_CHARS)&&(n=this.backwardsEndOffset(),t++)}while(this.backwardsEndOffset()<this.getEndSearchSpace().length&&t<e)}this.mode===this.Mode.SHARED_START_AND_END&&(this.endOffset=Math.max(this.startOffset,this.endOffset))}}let t=!1;if((!e||this.startOffset+this.backwardsEndOffset()<20||this.numIterations>=1)&&(null!=this.backwardsPrefixOffset()&&this.backwardsPrefixOffset()!==this.getPrefixSearchSpace().length||null!=this.suffixOffset&&this.suffixOffset!==this.getSuffixSearchSpace().length)&&(t=!0),t){const e=this.getNumberOfContextWordsToAdd();if(this.backwardsPrefixOffset()<this.getPrefixSearchSpace().length){let t=0;if(null!=this.getPrefixSegments())for(;t<e&&this.prefixOffset>0;)this.prefixOffset=this.getNextOffsetBackwards(this.getPrefixSegments(),this.prefixOffset),t++;else{let n=this.backwardsPrefixOffset();do{ms();const e=this.getBackwardsPrefixSearchSpace().substring(this.backwardsPrefixOffset()+1).search(as.BOUNDARY_CHARS);-1===e?this.setBackwardsPrefixOffset(this.getBackwardsPrefixSearchSpace().length):this.setBackwardsPrefixOffset(this.backwardsPrefixOffset()+1+e),-1!==this.getBackwardsPrefixSearchSpace().substring(n,this.backwardsPrefixOffset()).search(as.NON_BOUNDARY_CHARS)&&(n=this.backwardsPrefixOffset(),t++)}while(this.backwardsPrefixOffset()<this.getPrefixSearchSpace().length&&t<e)}}if(this.suffixOffset<this.getSuffixSearchSpace().length){let t=0;if(null!=this.getSuffixSegments())for(;t<e&&this.suffixOffset<this.getSuffixSearchSpace().length;)this.suffixOffset=this.getNextOffsetForwards(this.getSuffixSegments(),this.suffixOffset,this.suffixOffset),t++;else{let n=this.suffixOffset;do{ms();const e=this.getSuffixSearchSpace().substring(this.suffixOffset+1).search(as.BOUNDARY_CHARS);this.suffixOffset=-1===e?this.getSuffixSearchSpace().length:this.suffixOffset+1+e,-1!==this.getSuffixSearchSpace().substring(n,this.suffixOffset).search(as.NON_BOUNDARY_CHARS)&&(n=this.suffixOffset,t++)}while(this.suffixOffset<this.getSuffixSearchSpace().length&&t<e)}}}return this.numIterations++,e||t}setStartAndEndSearchSpace(e,t){return this.startSearchSpace=e,this.endSearchSpace=t,this.backwardsEndSearchSpace=As(t),this.startOffset=0,this.endOffset=t.length,this.mode=this.Mode.ALL_PARTS,this}setSharedSearchSpace(e){return this.sharedSearchSpace=e,this.backwardsSharedSearchSpace=As(e),this.startOffset=0,this.endOffset=e.length,this.mode=this.Mode.SHARED_START_AND_END,this}setExactTextMatch(e){return this.exactTextMatch=e,this.mode=this.Mode.CONTEXT_ONLY,this}setPrefixAndSuffixSearchSpace(e,t){return e&&(this.prefixSearchSpace=e,this.backwardsPrefixSearchSpace=As(e),this.prefixOffset=e.length),t&&(this.suffixSearchSpace=t,this.suffixOffset=0),this}useSegmenter(e){return null==e||(this.mode===this.Mode.ALL_PARTS?(this.startSegments=e.segment(this.startSearchSpace),this.endSegments=e.segment(this.endSearchSpace)):this.mode===this.Mode.SHARED_START_AND_END&&(this.sharedSegments=e.segment(this.sharedSearchSpace)),this.prefixSearchSpace&&(this.prefixSegments=e.segment(this.prefixSearchSpace)),this.suffixSearchSpace&&(this.suffixSegments=e.segment(this.suffixSearchSpace))),this}getNumberOfContextWordsToAdd(){return 0===this.backwardsPrefixOffset()&&0===this.suffixOffset?3:1}getNumberOfRangeWordsToAdd(){return 0===this.startOffset&&0===this.backwardsEndOffset()?3:1}getNextOffsetForwards(e,t,n){let s=e.containing(t);for(;null!=s;){ms();const t=s.index+s.segment.length;if(s.isWordLike)return t;s=e.containing(t)}return n.length}getNextOffsetBackwards(e,t){let n=e.containing(t);for(n&&t!=n.index||(n=e.containing(t-1));null!=n;){if(ms(),n.isWordLike)return n.index;n=e.containing(n.index-1)}return 0}getStartSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSearchSpace:this.startSearchSpace}getStartSegments(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSegments:this.startSegments}getEndSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSearchSpace:this.endSearchSpace}getEndSegments(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSegments:this.endSegments}getBackwardsEndSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.backwardsSharedSearchSpace:this.backwardsEndSearchSpace}getPrefixSearchSpace(){return this.prefixSearchSpace}getPrefixSegments(){return this.prefixSegments}getBackwardsPrefixSearchSpace(){return this.backwardsPrefixSearchSpace}getSuffixSearchSpace(){return this.suffixSearchSpace}getSuffixSegments(){return this.suffixSegments}backwardsEndOffset(){return this.getEndSearchSpace().length-this.endOffset}setBackwardsEndOffset(e){this.endOffset=this.getEndSearchSpace().length-e}backwardsPrefixOffset(){return null==this.prefixOffset?null:this.getPrefixSearchSpace().length-this.prefixOffset}setBackwardsPrefixOffset(e){null!=this.prefixOffset&&(this.prefixOffset=this.getPrefixSearchSpace().length-e)}},Es=class{constructor(e,t){this.searchRange=e,this.isForwardTraversal=t,this.textFound=!1,this.textNodes=[],this.textInBlock=null}appendNode(e){if(null!==this.textInBlock)return;if(Bs(e))return void(this.textFound?(this.isForwardTraversal||this.textNodes.reverse(),this.textInBlock=this.textNodes.map((e=>e.textContent)).join("").trim()):this.textNodes=[]);if(!Ps(e))return;const t=this.getNodeIntersectionWithRange(e);this.textFound=this.textFound||""!==t.textContent.trim(),this.textNodes.push(t)}getNodeIntersectionWithRange(e){let t=null,n=null;return e===this.searchRange.startContainer&&0!==this.searchRange.startOffset&&(t=this.searchRange.startOffset),e===this.searchRange.endContainer&&this.searchRange.endOffset!==e.textContent.length&&(n=this.searchRange.endOffset),null!==t||null!==n?{textContent:e.textContent.substring(t??0,n??e.textContent.length)}:e}},ys=e=>1===((e,t=document)=>{const n=[],s=t.createRange();for(s.selectNodeContents(t.body);!s.collapsed&&n.length<2;){let i;if(e.prefix){const n=ts(e.prefix,s);if(null==n)break;Vn(s,n.startContainer,n.startOffset);const r=t.createRange();if(r.setStart(n.endContainer,n.endOffset),r.setEnd(s.endContainer,s.endOffset),Gn(r),r.collapsed)break;if(i=ts(e.textStart,r),null==i)break;if(0!==i.compareBoundaryPoints(Range.START_TO_START,r))continue}else{if(i=ts(e.textStart,s),null==i)break;Vn(s,i.startContainer,i.startOffset)}if(e.textEnd){const r=t.createRange();r.setStart(i.endContainer,i.endOffset),r.setEnd(s.endContainer,s.endOffset);let o=!1;for(;!r.collapsed&&n.length<2;){const u=ts(e.textEnd,r);if(null==u)break;if(Vn(r,u.startContainer,u.startOffset),i.setEnd(u.endContainer,u.endOffset),e.suffix){const r=zn(e.suffix,i,s,t);if(r===Yn.NO_SUFFIX_MATCH)break;if(r===Yn.SUFFIX_MATCH){o=!0,n.push(i.cloneRange());continue}if(r===Yn.MISPLACED_SUFFIX)continue}else o=!0,n.push(i.cloneRange())}if(!o)break}else if(e.suffix){const r=zn(e.suffix,i,s,t);if(r===Yn.NO_SUFFIX_MATCH)break;if(r===Yn.SUFFIX_MATCH){n.push(i.cloneRange()),Vn(s,s.startContainer,s.startOffset);continue}if(r===Yn.MISPLACED_SUFFIX)continue}else n.push(i.cloneRange())}return n})(e).length,As=e=>[...e||""].reverse().join(""),Ss=e=>!(e.toString().length>300)&&!Fs(e),Ds=e=>{let t=e.startContainer;return t.nodeType==Node.ELEMENT_NODE&&e.startOffset<t.childNodes.length&&(t=t.childNodes[e.startOffset]),t},xs=e=>{let t=e.endContainer;return t.nodeType==Node.ELEMENT_NODE&&e.endOffset>0&&(t=t.childNodes[e.endOffset-1]),t},Fs=e=>{const t=e.cloneRange();let n=Ds(t);const s=Os(n);if(!s)return!1;const i=new Set;for(;!t.collapsed&&null!=n;){if(Bs(n))return!0;null!=n&&t.setStartAfter(n),n=as.forwardTraverse(s,i),ms()}return!1},Cs=(e,t)=>{if(e.nodeType!==Node.TEXT_NODE)return-1;const n=null!=t?t:e.data.length;if(n<e.data.length&&as.BOUNDARY_CHARS.test(e.data[n]))return n;const s=e.data.substring(0,n),i=As(s).search(as.BOUNDARY_CHARS);return-1!==i?n-i:-1},Ts=(e,t)=>{if(e.nodeType!==Node.TEXT_NODE)return-1;const n=null!=t?t:0;if(n<e.data.length&&n>0&&as.BOUNDARY_CHARS.test(e.data[n-1]))return n;const s=e.data.substring(n).search(as.BOUNDARY_CHARS);return-1!==s?n+s:-1},Os=(e,t)=>{if(!e)return;let n=e;const s=null!=t?t:e;for(;!n.contains(s)||!Bs(n);)n.parentNode&&(n=n.parentNode);const i=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,(e=>as.acceptNodeIfVisibleInRange(e)));return i.currentNode=e,i},Ns=e=>{const t=as.makeNewSegmenter();if(t){const n=Ds(e);n!==e.startContainer&&e.setStartBefore(n),$s(t,!1,e)}else{const t=Cs(e.startContainer,e.startOffset);if(-1!==t)return void e.setStart(e.startContainer,t);if(Bs(e.startContainer)&&0===e.startOffset)return;const n=Os(e.startContainer);if(!n)return;const s=new Set;let i=as.backwardTraverse(n,s);for(;null!=i;){const t=Cs(i);if(-1!==t)return void e.setStart(i,t);if(Bs(i))return void(i.contains(e.startContainer)?e.setStart(i,0):e.setStartAfter(i));i=as.backwardTraverse(n,s),e.collapse()}}},ks=e=>{const t=(e=>{const t=Ds(e);if(Ps(t)&&as.isNodeVisible(t))return t;const n=as.makeTextNodeWalker(e);return n.currentNode=t,n.nextNode()})(e);if(null==t)return void e.collapse();Ds(e)!==t&&e.setStart(t,0);const n=xs(e),s=(e=>{const t=xs(e);if(Ps(t)&&as.isNodeVisible(t))return t;const n=as.makeTextNodeWalker(e);return n.currentNode=t,as.backwardTraverse(n,new Set)})(e);n!==s&&e.setEnd(s,s.textContent.length)},$s=(e,t,n)=>{const s=t?{node:n.endContainer,offset:n.endOffset}:{node:n.startContainer,offset:n.startOffset},i=Rs(s.node),r=i.preNodes.reduce(((e,t)=>e.concat(t.textContent)),""),o=i.innerNodes.reduce(((e,t)=>e.concat(t.textContent)),"");let u=r.length;s.node.nodeType===Node.TEXT_NODE?u+=s.offset:t&&(u+=o.length);const a=i.postNodes.reduce(((e,t)=>e.concat(t.textContent)),""),l=[...i.preNodes,...i.innerNodes,...i.postNodes];if(0==l.length)return;const c=r.concat(o,a),d=e.segment(c).containing(u);if(!d)return void(t?n.setEndAfter(l[l.length-1]):n.setEndBefore(l[0]));if(!d.isWordLike)return;if(u===d.index||u===d.index+d.segment.length)return;const h=t?d.index+d.segment.length:d.index;let f=0;for(const e of l){if(f<=h&&h<f+e.textContent.length){const s=h-f;return void(t?s>=e.textContent.length?n.setEndAfter(e):n.setEnd(e,s):s>=e.textContent.length?n.setStartAfter(e):n.setStart(e,s))}f+=e.textContent.length}t?n.setEndAfter(l[l.length-1]):n.setStartBefore(l[0])},Rs=e=>{const t=[],n=Os(e);if(!n)return;const s=new Set;let i=as.backwardTraverse(n,s);for(;null!=i&&!Bs(i);)ms(),i.nodeType===Node.TEXT_NODE&&t.push(i),i=as.backwardTraverse(n,s);t.reverse();const r=[];if(e.nodeType===Node.TEXT_NODE)r.push(e);else{const t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,(e=>as.acceptNodeIfVisibleInRange(e)));t.currentNode=e;let n=t.nextNode();for(;null!=n;)ms(),n.nodeType===Node.TEXT_NODE&&r.push(n),n=t.nextNode()}const o=[],u=Os(e);if(!u)return;const a=new Set([e]);let l=as.forwardTraverse(u,a);for(;null!=l&&!Bs(l);)ms(),l.nodeType===Node.TEXT_NODE&&o.push(l),l=as.forwardTraverse(u,a);return{preNodes:t,innerNodes:r,postNodes:o}},Ls=e=>{const t=as.makeNewSegmenter();if(t){const n=xs(e);n!==e.endContainer&&e.setEndAfter(n),$s(t,!0,e)}else{let t=e.endOffset,n=e.endContainer;n.nodeType===Node.ELEMENT_NODE&&e.endOffset<n.childNodes.length&&(n=n.childNodes[e.endOffset]);const s=Os(n);if(!s)return;const i=new Set([n]);for(;null!=n;){ms();const r=Ts(n,t);if(t=null,-1!==r)return void e.setEnd(n,r);if(Bs(n))return void(n.contains(e.endContainer)?e.setEnd(n,n.childNodes.length):e.setEndBefore(n));n=as.forwardTraverse(s,i)}e.collapse()}},Bs=e=>e.nodeType===Node.ELEMENT_NODE&&(as.BLOCK_ELEMENTS.includes(e.tagName)||"HTML"===e.tagName||"BODY"===e.tagName),Ps=e=>e.nodeType===Node.TEXT_NODE;"undefined"!=typeof goog&&goog.declareModuleId("googleChromeLabs.textFragmentPolyfill.fragmentGenerationUtils");const Ms=["text"],Is=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","BR","DETAILS","DIALOG","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","OL","P","PRE","SECTION","TABLE","UL","TR","TH","TD","COLGROUP","COL","CAPTION","THEAD","TBODY","TFOOT"],Hs=/[\t-\r -#%-\*,-\/:;\?@\[-\]_\{\}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,Us=e=>{const t=/^(?:(.+?)-,)?(?:(.+?))(?:,([^-]+?))?(?:,-(.+?))?$/;return{prefix:decodeURIComponent(e.replace(t,"$1")),textStart:decodeURIComponent(e.replace(t,"$2")),textEnd:decodeURIComponent(e.replace(t,"$3")),suffix:decodeURIComponent(e.replace(t,"$4"))}},js={NO_SUFFIX_MATCH:0,SUFFIX_MATCH:1,MISPLACED_SUFFIX:2},qs=(e,t,n,s)=>{const i=s.createRange();i.setStart(t.endContainer,t.endOffset),i.setEnd(n.endContainer,n.endOffset),Ws(i);const r=Zs(e,i);return null==r?js.NO_SUFFIX_MATCH:0!==r.compareBoundaryPoints(Range.START_TO_START,i)?js.MISPLACED_SUFFIX:js.SUFFIX_MATCH},Xs=(e,t,n)=>{try{e.setStart(t,n+1)}catch(n){e.setStartAfter(t)}},Ws=e=>{const t=Ys(e);let n=t.nextNode();for(;!e.collapsed&&null!=n;){if(n!==e.startContainer&&e.setStart(n,0),n.textContent.length>e.startOffset){if(!n.textContent[e.startOffset].match(/\s/))return}try{e.setStart(n,e.startOffset+1)}catch(s){n=t.nextNode(),null==n?e.collapse():e.setStart(n,0)}}},Ys=e=>document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,(t=>Vs(t,e))),zs=e=>{let t=e;for(;null!=t&&!(t instanceof HTMLElement);)t=t.parentNode;if(null!=t){const e=window.getComputedStyle(t);if("hidden"===e.visibility||"none"===e.display||0===e.height||0===e.width||0===e.opacity)return!1}return!0},Vs=(e,t)=>(null==t||t.intersectsNode(e))&&zs(e)?e.nodeType===Node.TEXT_NODE?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT,Gs=(e,t)=>{const n=[];let s=[];const i=Array.from(function*(e,t){const n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:t}),s=new Set;for(;null!==ni(n,s);)yield n.currentNode}(e,(e=>"katex-mathml"!==e.className&&((e,t)=>(null==t||t.intersectsNode(e))&&zs(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT)(e,t))));for(const e of i)e.nodeType===Node.TEXT_NODE?s.push(e):e instanceof HTMLElement&&Is.includes(e.tagName)&&s.length>0&&(n.push(s),s=[]);return s.length>0&&n.push(s),n};const Zs=(e,t)=>{const n=Gs(t.commonAncestorContainer,t),s=ti();for(const i of n){const n=Ks(e,t,i,s);if(void 0!==n)return n}},Ks=(e,t,n,s)=>{if(!e||!t||!(n||[]).length)return;const i=ei(((e,t,n)=>{let s="";return s=1===e.length?e[0].textContent.substring(t,n):e[0].textContent.substring(t)+e.slice(1,-1).reduce(((e,t)=>e+t.textContent),"")+e.slice(-1)[0].textContent.substring(0,n),s.replace(/[\t\n\r ]+/g," ")})(n,0,void 0)),r=ei(e);let o,u,a=n[0]===t.startNode?t.startOffset:0;for(;a<i.length;){const e=i.indexOf(r,a);if(-1===e)return;if(Qs(i,e,r.length,s)&&(o=Js(e,n,!1),u=Js(e+r.length,n,!0)),null!=o&&null!=u){const e=new Range;if(e.setStart(o.node,o.offset),e.setEnd(u.node,u.offset),t.compareBoundaryPoints(Range.START_TO_START,e)<=0&&t.compareBoundaryPoints(Range.END_TO_END,e)>=0)return e}a=e+1}},Js=(e,t,n)=>{let s,i=0;for(let r=0;r<t.length;r++){const o=t[r];s||(s=ei(o.data));let u=i+s.length;if(n&&(u+=1),u>e){const t=e-i;let r=Math.min(e-i,o.data.length);const u=n?s.substring(0,t):s.substring(t);let a=ei(n?o.data.substring(0,r):o.data.substring(r));const l=(n?-1:1)*(u.length>a.length?-1:1);for(;r>=0&&r<=o.data.length;){if(a.length===u.length)return{node:o,offset:r};r+=l,a=ei(n?o.data.substring(0,r):o.data.substring(r))}}if(i+=s.length,r+1<t.length){const e=ei(t[r+1].data);" "===s.slice(-1)&&" "===e.slice(0,1)&&(i-=1),s=e}}},Qs=(e,t,n,s)=>{if(t<0||t>=e.length||n<=0||t+n>e.length)return!1;if(s){const i=s.segment(e),r=i.containing(t);if(!r)return!1;if(r.isWordLike&&r.index!=t)return!1;const o=t+n,u=i.containing(o);if(u&&u.isWordLike&&u.index!=o)return!1}else{if(e[t].match(Hs)&&(++t,!--n))return!1;if(e[t+n-1].match(Hs)&&!--n)return!1;if(0!==t&&!e[t-1].match(Hs))return!1;if(t+n!==e.length&&!e[t+n].match(Hs))return!1}return!0},ei=e=>(e||"").normalize("NFKD").replace(/\s+/g," ").replace(/[\u0300-\u036f]/g,"").toLowerCase(),ti=()=>{if(Intl.Segmenter){let e=document.documentElement.lang;return e||(e=navigator.languages),new Intl.Segmenter(e,{granularity:"word"})}},ni=(e,t)=>{if(!t.has(e.currentNode)){const t=e.firstChild();if(null!==t)return t}const n=e.nextSibling();if(null!==n)return n;const s=e.parentNode();return null!==s&&t.add(s),s};function si(e){let t=Object.assign({container:document.body,theme:"dark",useAlpha:!0,color:{r:250,g:250,b:68}},e),n=this,s={color_wheel:null,brightness_slider:null,tab_selection_buttons:null,red_input:null,green_input:null,blue_input:null,hue_input:null,saturation_input:null,brightness_input:null,hex_input:null,alpha_input:null},i={color_change:null,color_wheel_change:null,brightness_slider_change:null,tab_selection_change:null,hue_input_change:null,saturation_input_change:null,brightness_input_change:null,red_input_change:null,green_input_change:null,blue_input_change:null,alpha_input_change:null,hex_input_change:null},r={hsvToHsl:function(e,t,n){const s=(2-(t/=100))*(n/=100)/2;return 0!==s&&(t=1===s?0:s<.5?t*n/(2*s):t*n/(2-2*s)),[e,100*t,100*s]},hslToHsv:function(e,t,n){t/=100;const s=2*(t*=(n/=100)<.5?n:1-n)/(n+t)*100,i=100*(n+t);return[e,isNaN(s)?0:s,i]},hsvToRgb:function(e,t,n){e=e/360*6,t/=100,n/=100;const s=Math.floor(e),i=e-s,r=n*(1-t),o=n*(1-i*t),u=n*(1-(1-i)*t),a=s%6;return[255*[n,o,r,r,u,n][a],255*[u,n,n,o,r,r][a],255*[r,r,u,n,n,o][a]]},rgbToHsv:function(e,t,n){e/=255,t/=255,n/=255;const s=Math.min(e,t,n),i=Math.max(e,t,n),r=i-s;let o,u;if(0===r)o=u=0;else{u=r/i;const s=((i-e)/6+r/2)/r,a=((i-t)/6+r/2)/r,l=((i-n)/6+r/2)/r;e===i?o=l-a:t===i?o=1/3+s-l:n===i&&(o=2/3+a-s),o<0?o+=1:o>1&&(o-=1)}return[360*o,100*u,100*i]},hsvToHex:function(e,t,n){return r.hsvToRgb(e,t,n).map((e=>Math.round(e).toString(16).padStart(2,"0")))},hexToHsv:function(e){return e=e.trim().toLowerCase().replace(/ /g,"").replace(/[^A-Za-z0-9\s]/g,""),r.rgbToHsv(...e.match(/.{2}/g).map((e=>parseInt(e,16))))},hexToRgb:function(e){let t,n,s;return t=(e=e.trim().toLowerCase().replace(/ /g,"").replace(/[^A-Za-z0-9\s]/g,"")).charAt(0)+""+e.charAt(1),n=e.charAt(2)+""+e.charAt(3),s=e.charAt(4)+""+e.charAt(5),t=parseInt(t,16),n=parseInt(n,16),s=parseInt(s,16),[t,n,s]},getBoundingBox:function(e){let t=e.getBoundingClientRect();return{top:t.top+(window.pageYOffset||document.documentElement.scrollTop),left:t.left+(window.pageXOffset||document.documentElement.scrollLeft),width:t.width,height:t.height}},degreesToRadians:function(e){return e*(Math.PI/180)},countDecimals:function(e){return Math.floor(e.valueOf())===e.valueOf()?0:e.toString().split(".")[1].length||0},round:function(e,t){let n=Number(Math.round(e+"e"+t)+"e-"+t);return isNaN(n)?0:n}},o={open:[],change:[],close:[]};this.root=document.createElement("div"),this.container=t.container;let u=!0;Object.defineProperty(n,"isOpen",{get:function(){return u},set:function(e){null!=e&&(u=e,n.root.style.visibility=u?"visible":"collapse",l(u?"open":"close",n))},enumerable:!0,configurable:!0});let a=(new f).fromRGBa(t.color.r||255,t.color.g||255,t.color.b||255);Object.defineProperty(n,"color",{get:function(){return a},set:function(e){e instanceof f&&(a.dispose(),a=e,l("change",n.value))},enumerable:!0,configurable:!0});let l=function(e,...t){o[e].forEach((e=>e(...t,n)))};this.on=function(e,t){return o[e]=o[e]||[],o[e].push(t),this},this.off=function(e,t){const n=o[e]||[],s=n.indexOf(t);return~s&&n.splice(s,1),this};let c=function(){n.root.innerHTML='\n            <div class="color-picker"> \n            <div class="color-picker-controls">\n                <div class="color-picker-controls-group" style="display: flex; flex-direction: row;height: 160px;">\n                    <div class="color-picker-brightness-control">\n                        <canvas id="brightness-canvas" class="brightness-canvas"></canvas>\n                        <div class="color-picker-brightness-control-thumb" style="bottom: 0; left: 50%;"></div>\n                    </div>\n                    <div class="color-picker-wheel-control">\n                        <canvas id="wheel-canvas" class="wheel-canvas"></canvas>\n                        <div class="color-picker-wheel-control-thumb" style="top:50%; left: 50%;"></div>\n                    </div>\n                </div>\n                <div class="color-picker-controls-group" style="flex: 1; padding-top: 0;">\n                    <div class="color-picker-input-controls">\n                        <div class="color-picker-input-controls-tab-headers">\n                            <button data-tab="rgb">RGB</button>\n                            <button data-tab="hsv" class="selected">HSV</button>\n                            <button data-tab="hex">HEX</button>\n                        </div>\n                        <div class="color-picker-input-controls-tabs">\n                            <div class="color-picker-input-controls-tab" data-tab="rgb">\n                                <div class="color-picker-red-input range-input-control" data-value="0" data-step="0.01" data-min="0" data-max="255">\n                                    <div class="range-input-enter-block">\n                                        <input class="range-input" type="number">\n                                    </div>\n                                    <div class="range-input-details-block">\n                                        <span class="range-input-progress"></span>\n                                        <span class="range-input-label">R:</span>\n                                        <span class="range-input-value">0.00</span>\n                                    </div>\n                                </div>\n                                <div class="color-picker-green-input range-input-control" data-value="0" data-step="0.01" data-min="0" data-max="255">\n                                    <div class="range-input-enter-block">\n                                        <input class="range-input" type="number">\n                                    </div>\n                                    <div class="range-input-details-block">\n                                        <span class="range-input-progress"></span>\n                                        <span class="range-input-label">G:</span>\n                                        <span class="range-input-value">0.00</span>\n                                    </div>\n                                </div>\n                                <div class="color-picker-blue-input range-input-control" data-value="0" data-step="0.01" data-min="0" data-max="255">\n                                    <div class="range-input-enter-block">\n                                        <input class="range-input" type="number">\n                                    </div>\n                                    <div class="range-input-details-block">\n                                        <span class="range-input-progress"></span>\n                                        <span class="range-input-label">B:</span>\n                                        <span class="range-input-value">0.00</span>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="color-picker-input-controls-tab selected" data-tab="hsv">\n                                <div class="color-picker-hue-input range-input-control" data-value="0" data-step="0.01" data-min="0" data-max="360">\n                                    <div class="range-input-enter-block">\n                                        <input class="range-input" type="number">\n                                    </div>\n                                    <div class="range-input-details-block">\n                                        <span class="range-input-progress"></span>\n                                        <span class="range-input-label">H:</span>\n                                        <span class="range-input-value">0.00</span>\n                                    </div>\n                                </div>\n                                <div class="color-picker-saturation-input range-input-control" data-value="0" data-step="0.01" data-min="0" data-max="100">\n                                    <div class="range-input-enter-block">\n                                        <input class="range-input" type="number">\n                                    </div>\n                                    <div class="range-input-details-block">\n                                        <span class="range-input-progress"></span>\n                                        <span class="range-input-label">S:</span>\n                                        <span class="range-input-value">0.00</span>\n                                    </div>\n                                </div>\n                                <div class="color-picker-brightness-input range-input-control" data-value="0" data-step="0.01" data-min="0" data-max="100">\n                                    <div class="range-input-enter-block">\n                                        <input class="range-input" type="number">\n                                    </div>\n                                    <div class="range-input-details-block">\n                                        <span class="range-input-progress"></span>\n                                        <span class="range-input-label">V:</span>\n                                        <span class="range-input-value">0.00</span>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="color-picker-input-controls-tab" data-tab="hex">\n                                <div class="color-picker-hex-input text-input-control" data-value="000000" data-is-alphanumeric="true">\n                                    <div class="text-input-enter-block">\n                                        <input class="text-input" type="text">\n                                    </div>\n                                    <div class="text-input-details-block">\n                                        <span class="text-input-label">Hex:</span>\n                                        <span class="text-input-value">000000</span>\n                                    </div>\n                                </div>\n                            </div>'+(t.useAlpha?'<div class="color-picker-alpha-input range-input-control" data-value="255" data-step="0.01" data-min="0" data-max="255">\n                                    <div class="range-input-enter-block">\n                                        <input class="range-input" type="number">\n                                    </div>\n                                    <div class="range-input-details-block">\n                                        <span class="range-input-progress"></span>\n                                        <span class="range-input-label">A:</span>\n                                        <span class="range-input-value">0.00</span>\n                                    </div>\n                                </div>':"")+"</div>\n                    </div>\n                </div>\n            </div>\n        </div>".trim(),n.container.appendChild(n.root),n.root.dataset.theme=t.theme,n.isOpen=t.isOpen,s.color_wheel=new p({color_picker:n}),s.color_wheel.values.hue=n.color.h,s.color_wheel.values.saturation=n.color.s,s.brightness_slider=new g({color_picker:n}),s.brightness_slider.value=n.color.v,s.tab_selection_buttons=n.root.querySelectorAll(".color-picker-input-controls-tab-headers button"),s.red_input=new m(n.root.querySelector(".color-picker-red-input")),s.green_input=new m(n.root.querySelector(".color-picker-green-input")),s.blue_input=new m(n.root.querySelector(".color-picker-blue-input"));let e=r.hsvToRgb(n.color.h,n.color.s,n.color.v);s.red_input.value=e[0],s.green_input.value=e[1],s.blue_input.value=e[2],s.hue_input=new m(n.root.querySelector(".color-picker-hue-input")),s.hue_input.value=n.color.h,s.saturation_input=new m(n.root.querySelector(".color-picker-saturation-input")),s.saturation_input.value=n.color.s,s.brightness_input=new m(n.root.querySelector(".color-picker-brightness-input")),s.brightness_input.value=n.color.v,s.hex_input=new v(n.root.querySelector(".color-picker-hex-input"));let i=r.hsvToHex(n.color.h,n.color.s,n.color.v);s.hex_input.value=i.join("").toUpperCase(),t.useAlpha&&(s.alpha_input=new m(n.root.querySelector(".color-picker-alpha-input")),s.alpha_input.value=n.color.a),d()},d=function(){i.tab_selection_change=function(e){s.tab_selection_buttons.forEach((e=>e.classList.remove("selected"))),n.root.querySelectorAll(".color-picker-input-controls-tab").forEach((e=>e.classList.remove("selected"))),e.target.classList.add("selected"),n.root.querySelector('.color-picker-input-controls-tab[data-tab="'+e.target.dataset.tab+'"]').classList.add("selected")},s.tab_selection_buttons.forEach((e=>e.addEventListener("click",i.tab_selection_change))),i.color_change=()=>n.update(),n.color.on("change",i.color_change),i.color_wheel_change=function(e){n.color.h=e.hue,n.color.s=e.saturation,n.update(),l("change",n.color)},s.color_wheel.on("change",i.color_wheel_change),i.brightness_slider_change=function(e){n.color.v=e,n.update(),l("change",n.color)},s.brightness_slider.on("change",i.brightness_slider_change),i.hue_input_change=function(e){n.color.h=e,n.update(),l("change",n.color)},s.hue_input.on("change",i.hue_input_change),i.saturation_input_change=function(e){n.color.s=e,n.update(),l("change",n.color)},s.saturation_input.on("change",i.saturation_input_change),i.brightness_input_change=function(e){n.color.v=e,n.update(),l("change",n.color)},s.brightness_input.on("change",i.brightness_input_change),i.red_input_change=function(e){let t=r.rgbToHsv(s.red_input.value,s.green_input.value,s.blue_input.value);n.color.h=t[0],n.color.s=t[1],n.color.v=t[2],n.update(),l("change",n.color)},s.red_input.on("change",i.red_input_change),i.green_input_change=function(e){let t=r.rgbToHsv(s.red_input.value,s.green_input.value,s.blue_input.value);n.color.h=t[0],n.color.s=t[1],n.color.v=t[2],n.update(),l("change",n.color)},s.green_input.on("change",i.green_input_change),i.blue_input_change=function(e){let t=r.rgbToHsv(s.red_input.value,s.green_input.value,s.blue_input.value);n.color.h=t[0],n.color.s=t[1],n.color.v=t[2],n.update(),l("change",n.color)},s.blue_input.on("change",i.blue_input_change),i.hex_input_change=function(e){let t=s.hex_input.value.trim().toLowerCase().replace(/ /g,"").replace(/[^A-Za-z0-9\s]/g,""),i=r.hexToHsv(t.padEnd(6,"0"));n.color.h=i[0]||0,n.color.s=i[1]||0,n.color.v=i[2]||0,n.update(),l("change",n.color)},s.hex_input.on("change",i.hex_input_change),t.useAlpha&&(i.alpha_input_change=function(e){n.color.a=e,n.update(),l("change",n.color)},s.alpha_input.on("change",i.alpha_input_change))},h=function(){s.tab_selection_buttons.forEach((e=>e.removeEventListener("click",i.tab_selection_change))),n.color.off("change",i.color_change),s.color_wheel.off("change",i.color_wheel_change),s.brightness_slider.off("change",i.brightness_slider_change),s.hue_input.off("change",i.hue_input_change),s.saturation_input.off("change",i.saturation_input_change),s.brightness_input.off("change",i.brightness_input_change),s.red_input.off("change",i.red_input_change),s.green_input.off("change",i.green_input_change),s.blue_input.off("change",i.blue_input_change),s.hex_input.off("change",i.hex_input_change),t.useAlpha&&s.alpha_input.off("change",i.alpha_input_change)};function f(e=360,t=0,s=100,i=255){this.h=e,this.s=t,this.v=s,this.a=i;let o={change:[]},u=function(e,...t){o[e].forEach((e=>e(...t,n)))};this.on=function(e,t){return o[e]=o[e]||[],o[e].push(t),this},this.off=function(e,t){const n=o[e]||[],s=n.indexOf(t);return~s&&n.splice(s,1),this},this.fromHSVa=function(e=0,t=0,n=0,s=255){return this.h=e,this.s=t,this.v=n,this.a=s,u("change",this),this},this.toHSV=function(){let e=[this.h,this.s,this.v];var t,n;return e.toString=(t=e,n=e=>`hsv(${e[0]}, ${e[1]}%, ${e[2]}%)`,(e=-1)=>n(~e?t.map((t=>Number(t.toFixed(e)))):t)),e},this.toHSVa=function(){let e=[this.h,this.s,this.v,this.a];var t,n;return e.toString=(t=e,n=e=>`hsva(${e[0]}, ${e[1]}%, ${e[2]}%, ${this.a})`,(e=-1)=>n(~e?t.map((t=>Number(t.toFixed(e)))):t)),e},this.fromHSLa=function(e,t,n,s=255){let i=r.hslToHsv(e,t,n);return null!=i?(this.h=i[0]||0,this.s=i[1]||0,this.v=i[2]||0,this.a=s):console.error("Error while parsing hsl into hsv"),u("change",this),this},this.toHSL=function(){let e=[...r.hsvToHsl(this.h,this.s,this.v)];var t,n;return e.toString=(t=e,n=e=>`hsl(${e[0]}, ${e[1]}%, ${e[2]}%)`,(e=-1)=>n(~e?t.map((t=>Number(t.toFixed(e)))):t)),e},this.toHSLa=function(){let e=[...r.hsvToHsl(this.h,this.s,this.v),this.a];var t,n;return e.toString=(t=e,n=e=>`hsla(${e[0]}, ${e[1]}%, ${e[2]}%, ${this.a})`,(e=-1)=>n(~e?t.map((t=>Number(t.toFixed(e)))):t)),e},this.fromRGBa=function(e=0,t=0,n=0,s=255){let i=r.rgbToHsv(e,t,n);return null!=i?(this.h=i[0]||0,this.s=i[1]||0,this.v=i[2]||0,this.a=s):console.error("Error while parsing rgb into hsv"),u("change",this),this},this.toRGB=function(){let e=[...r.hsvToRgb(this.h,this.s,this.v)];var t,n;return e.toString=(t=e,n=e=>`rgb(${e[0]}, ${e[1]}, ${e[2]})`,(e=-1)=>n(~e?t.map((t=>Number(t.toFixed(e)))):t)),e},this.toRGBa=function(){let e=[...r.hsvToRgb(this.h,this.s,this.v),this.a];var t,n;return e.toString=(t=e,n=e=>`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${this.a})`,(e=-1)=>n(~e?t.map((t=>Number(t.toFixed(e)))):t)),e},this.fromHEX=function(e,t=255){e=e.trim().toLowerCase().replace(/ /g,"").replace(/[^A-Za-z0-9\s]/g,"");let n=r.hexToHsv(e.padEnd(6,"0"));return null!=n?(this.h=n[0]||0,this.s=n[1]||0,this.v=n[2]||0,this.a=t):console.error("Error while parsing hex into hsv"),u("change",this),this},this.toHEX=function(){return`#${r.hsvToHex(this.h,this.s,this.v).join("").toUpperCase()}`},this.dispose=function(){for(var e in o.change.splice(0,o.change.length),o.change=null,u=null,this)delete this[e]}}function p({color_picker:e=null}){let t,n=this,s=e.root.querySelector(".color-picker-wheel-control"),i=s.querySelector("canvas"),o=document.createElement("canvas"),u=s.querySelector(".color-picker-wheel-control-thumb"),a=!1,l={thumb_mousedown:null,canvas_mousedown:null,document_mousemove:null,document_mouseup:null},c={change:[]};this.values={};let d=e.color.h;Object.defineProperty(this.values,"hue",{get:function(){return d},set:function(e){null!=e&&(e>360&&(e=360),e<0&&(e=0),d=e,n.update())},enumerable:!0,configurable:!0});let h=e.color.s;Object.defineProperty(this.values,"saturation",{get:function(){return h},set:function(e){null!=e&&(e>100&&(e=100),e<0&&(e=0),h=e,n.update())},enumerable:!0,configurable:!0});let f=function(e,...t){c[e].forEach((e=>e(...t,n)))};this.on=function(e,t){return c[e]=c[e]||[],c[e].push(t),this},this.off=function(e,t){const n=c[e]||[],s=n.indexOf(t);return~s&&n.splice(s,1),this};let p=async function(){await g(),m(),v(),_()},g=async function(){return new Promise(((e,n)=>{let s=document.createElement("canvas");s.width=s.height=512;let i=s.getContext("2d"),r=s.width/2,o=1/r;i.clearRect(0,0,s.width,s.height);let u=r,a=r;for(let e=0;e<360;e+=o){let t=e*(2*Math.PI)/360,n=r*Math.cos(t),s=r*Math.sin(t);i.strokeStyle="hsl("+e+", 100%, 50%)",i.beginPath(),i.moveTo(r,r),i.lineTo(u+n,a+s),i.stroke()}let l=i.createRadialGradient(u,a,0,u,u,r);l.addColorStop(0,"rgba(255, 255, 255, 1)"),l.addColorStop(1,"rgba(255, 255, 255, 0)"),i.fillStyle=l,i.beginPath(),i.arc(u,a,r,0,2*Math.PI,!0),i.closePath(),i.fill(),i.beginPath(),i.strokeStyle="rgb(38, 41, 50)",i.arc(u,a,r,0,2*Math.PI),i.stroke(),t=new Image,t.onload=()=>e(),t.src=s.toDataURL()}))},m=function(){let n=r.getBoundingBox(i);i.width=i.height=n.width,o.width=o.height=n.width;let s=i.getContext("2d"),u=o.getContext("2d");s.translate(i.width/2,i.height/2),s.rotate(90*Math.PI/180),s.translate(-i.width/2,-i.height/2),s.beginPath(),s.arc(i.width/2,i.width/2,i.width/2,0,2*Math.PI),s.clip(),s.closePath();let a=document.createElement("canvas"),l=10;a.width=20,a.height=20;let c=a.getContext("2d"),d="rgba(255, 255, 255, 1)",h="rgba(205, 205,205, 1)";c.beginPath(),c.fillStyle=d,c.fillRect(0,0,l,l),c.closePath(),c.beginPath(),c.fillStyle=h,c.fillRect(l,0,l,l),c.closePath(),c.beginPath(),c.fillStyle=h,c.fillRect(0,l,l,l),c.closePath(),c.beginPath(),c.fillStyle=d,c.fillRect(l,l,l,l),c.closePath();let f=s.createPattern(a,"repeat");s.beginPath(),s.fillStyle=f,s.fillRect(0,0,i.width,i.height),s.closePath(),s.beginPath(),s.strokeStyle="rgb(217, 214, 205)",s.arc(i.width/2,i.width/2,i.width/2,0,2*Math.PI),s.stroke(),s.closePath(),u.drawImage(t,0,0,i.width,i.height),u.fillStyle="rgba(0, 0, 0, "+Math.abs(1-e.color.v/100)+")",u.fillRect(0,0,i.width,i.height),s.globalAlpha=e.color.a/255,s.drawImage(o,0,0,i.width,i.height)},v=function(){let t=r.getBoundingBox(i),n=r.getBoundingBox(u);u.style.backgroundColor=e.color.toRGB().toString(),a||(u.style.left=t.width/2+t.width/2/100*e.color.s*Math.cos(r.degreesToRadians(e.color.h+90))-n.width/2+"px",u.style.top=t.height/2+t.width/2/100*e.color.s*Math.sin(r.degreesToRadians(e.color.h+90))-n.height/2+"px"),u.dataset.value1=e.color.h,u.dataset.value2=e.color.s},_=function(){l.thumb_mousedown=function(e){document.selection?document.selection.empty():window.getSelection().removeAllRanges(),a=!0},u.addEventListener("mousedown",l.thumb_mousedown,!0),u.addEventListener("touchstart",l.thumb_mousedown,!0),l.canvas_mousedown=function(e){document.selection?document.selection.empty():window.getSelection().removeAllRanges(),a=!0;let t=e.touches?e.touches[0].pageX:e.pageX,s=e.touches?e.touches[0].pageY:e.pageY,o=r.getBoundingBox(i),l=r.getBoundingBox(u),c=o.width/2,d=t,h=s,p=o.left+o.width/2,g=o.top+o.height/2,m=360*Math.atan2(h-g,d-p)/(2*Math.PI)-90;m<0&&(m+=360),Math.sqrt((d-p)*(d-p)+(h-g)*(h-g))>c?(u.style.left=o.width/2+c*Math.cos(r.degreesToRadians(m+90))-l.width/2+"px",u.style.top=o.height/2+c*Math.sin(r.degreesToRadians(m+90))-l.height/2+"px"):(u.style.left=t-o.left-l.width/2+"px",u.style.top=s-o.top-l.height/2+"px"),o=r.getBoundingBox(i),l=r.getBoundingBox(u);let v=o.left+o.width/2-(l.left+l.width/2),_=o.top+o.height/2-(l.top+l.height/2),b=Math.sqrt(Math.pow(v,2)+Math.pow(_,2)),w=m,E=Math.min(100,Math.ceil(b/c*100));n.values.hue=w,n.values.saturation=E,u.dataset.value1=w,u.dataset.value2=E,f("change",n.values)},i.addEventListener("mousedown",l.canvas_mousedown,!0),i.addEventListener("touchstart",l.canvas_mousedown,!0),l.document_mousemove=function(e){if(a){e.preventDefault(),e.stopImmediatePropagation();let t=e.touches?e.touches[0].pageX:e.pageX,s=e.touches?e.touches[0].pageY:e.pageY,o=r.getBoundingBox(i),a=r.getBoundingBox(u),l=o.width/2,c=t,d=s,h=o.left+o.width/2,p=o.top+o.height/2,g=360*Math.atan2(d-p,c-h)/(2*Math.PI)-90;g<0&&(g+=360),Math.sqrt((c-h)*(c-h)+(d-p)*(d-p))>l?(u.style.left=o.width/2+l*Math.cos(r.degreesToRadians(g+90))-a.width/2+"px",u.style.top=o.height/2+l*Math.sin(r.degreesToRadians(g+90))-a.height/2+"px"):(u.style.left=t-o.left-a.width/2+"px",u.style.top=s-o.top-a.height/2+"px"),o=r.getBoundingBox(i),a=r.getBoundingBox(u);let m=o.left+o.width/2-(a.left+a.width/2),v=o.top+o.height/2-(a.top+a.height/2),_=Math.sqrt(Math.pow(m,2)+Math.pow(v,2)),b=g,w=Math.min(100,Math.ceil(_/l*100));n.values.hue=b,n.values.saturation=w,u.dataset.value1=b,u.dataset.value2=w,f("change",n.values)}},document.addEventListener("mousemove",l.document_mousemove,!0),document.addEventListener("touchmove",l.document_mousemove,{passive:!1}),l.document_mouseup=function(e){a=!1},document.addEventListener("mouseup",l.document_mouseup,!0),document.addEventListener("touchend",l.document_mouseup,!0)},b=function(){u.removeEventListener("mousedown",l.thumb_mousedown,!1),u.removeEventListener("touchstart",l.thumb_mousedown,!1),i.removeEventListener("mousedown",l.canvas_mousedown,!1),i.removeEventListener("touchstart",l.canvas_mousedown,!1),document.removeEventListener("mousemove",l.document_mousemove,!1),document.removeEventListener("touchmove",l.document_mousemove,!1),document.removeEventListener("mouseup",l.document_mouseup,!1),document.removeEventListener("touchend",l.document_mouseup,!1)};this.update=function(e){m(),v()},this.dispose=function(){for(var e in b(),this.values=null,d=null,h=null,l.thumb_mousedown=null,l.canvas_mousedown=null,l.document_mousemove=null,l.document_mouseup=null,c.change.splice(0,c.change.length),c.change=null,n=null,s=null,i=null,o=null,u=null,a=null,t=null,l=null,c=null,f=null,p=null,g=null,m=null,v=null,_=null,b=null,this)delete this[e]},p()}function g({color_picker:e=null}){let t=this,n=e.root.querySelector(".color-picker-brightness-control"),s=n.querySelector("canvas"),i=n.querySelector(".color-picker-brightness-control-thumb"),o=!1,u={thumb_mousedown:null,canvas_mousedown:null,document_mousemove:null,document_mouseup:null},a={change:[]},l=e.color.v;Object.defineProperty(t,"value",{get:function(){return l},set:function(e){null!=e&&(e>100&&(e=100),e<0&&(e=0),l=e,t.update())},enumerable:!0,configurable:!0});let c=function(e,...n){a[e].forEach((e=>e(...n,t)))};this.on=function(e,t){return a[e]=a[e]||[],a[e].push(t),this},this.off=function(e,t){const n=a[e]||[],s=n.indexOf(t);return~s&&n.splice(s,1),this};let d=function(){h(),f(),p()},h=function(){let t=r.getBoundingBox(s);s.width=t.width,s.height=t.height;let n=s.getContext("2d").createLinearGradient(0,0,0,s.height),i=r.hsvToRgb(e.color.h,e.color.s,100),o=[0,0,0];n.addColorStop(0,"rgb("+i[0]+","+i[1]+","+i[2]+")"),n.addColorStop(1,"rgb("+o[0]+","+o[1]+","+o[2]+")"),s.getContext("2d").fillStyle=n,s.getContext("2d").fillRect(0,0,s.width,s.height)},f=function(){let n=r.getBoundingBox(s),u=r.getBoundingBox(i);i.style.backgroundColor=e.color.toRGB().toString(),i.style.left=n.width/2-u.width/2+"px",o||(i.style.top=-u.height/2+n.height*((100-t.value)/100)+"px"),i.dataset.value=t.value},p=function(){u.thumb_mousedown=function(e){document.selection?document.selection.empty():window.getSelection().removeAllRanges(),o=!0},i.addEventListener("mousedown",u.thumb_mousedown,!0),i.addEventListener("touchstart",u.thumb_mousedown,!0),u.canvas_mousedown=function(e){document.selection?document.selection.empty():window.getSelection().removeAllRanges(),o=!0;let n=e.touches?e.touches[0].pageY:e.pageY,u=r.getBoundingBox(s),a=r.getBoundingBox(i);i.style.left=u.width/2-a.width/2+"px",u.top<=n+a.height/2&&n+a.height/2<=u.top+u.height?i.style.top=n-u.top+"px":u.top>n+a.height/2?i.style.top=-a.height/2+"px":i.style.top=u.height-a.height/2+"px",u=r.getBoundingBox(s),a=r.getBoundingBox(i);let l=100-(a.top+a.height/2-u.top)/u.height*100;t.value=l,i.dataset.value=l,c("change",t.value)},s.addEventListener("mousedown",u.canvas_mousedown,!0),s.addEventListener("touchstart",u.canvas_mousedown,!0),u.document_mousemove=function(e){if(o){e.preventDefault(),e.stopImmediatePropagation();let n=e.touches?e.touches[0].pageY:e.pageY,o=r.getBoundingBox(s),u=r.getBoundingBox(i);i.style.left=o.width/2-u.width/2+"px",o.top<=n+u.height/2&&n+u.height/2<=o.top+o.height?i.style.top=n-o.top+"px":o.top>n+u.height/2?i.style.top=-u.height/2+"px":i.style.top=o.height-u.height/2+"px",o=r.getBoundingBox(s),u=r.getBoundingBox(i);let a=100-(u.top+u.height/2-o.top)/o.height*100;t.value=a,i.dataset.value=a,c("change",t.value)}},document.addEventListener("mousemove",u.document_mousemove,!0),document.addEventListener("touchmove",u.document_mousemove,{passive:!1}),u.document_mouseup=function(e){o=!1},document.addEventListener("mouseup",u.document_mouseup,!0),document.addEventListener("touchend",u.document_mouseup,!0)},g=function(){i.removeEventListener("mousedown",u.thumb_mousedown,!1),i.removeEventListener("touchstart",u.thumb_mousedown,!1),s.removeEventListener("mousedown",u.canvas_mousedown,!1),s.removeEventListener("touchstart",u.canvas_mousedown,!1),document.removeEventListener("mousemove",u.document_mousemove,!1),document.removeEventListener("touchmove",u.document_mousemove,!1),document.removeEventListener("mouseup",u.document_mouseup,!1),document.removeEventListener("touchend",u.document_mouseup,!1)};this.update=function(e){h(),f()},this.dispose=function(){for(var e in g(),this.value=null,l=null,u.thumb_mousedown=null,u.canvas_mousedown=null,u.document_mousemove=null,u.document_mouseup=null,a.change.splice(0,a.change.length),a.change=null,t=null,n=null,s=null,i=null,o=null,u=null,a=null,c=null,d=null,h=null,f=null,p=null,g=null,this)delete this[e]},d()}function m(e){this.root=e,this.min=Number(e.dataset.min),this.max=Number(e.dataset.max),this.step=Number(e.dataset.step)||1;let t=this,n=e.querySelector(".range-input"),s=e.querySelector(".range-input-progress"),i=e.querySelector(".range-input-value"),o=document.createElement("div"),u=!1,a=!1,l=null,c={root_mousedown:null,input_focusout:null,input_keyup:null},d={focus:[],blur:[],change:[]},h=Number(e.dataset.value)||0;Object.defineProperty(t,"value",{get:function(){return h},set:function(e){null!=e&&(null!=t.max&&e>t.max&&(e=t.max),null!=t.min&&e<t.min&&(e=t.min),h=r.round(Number(e),r.countDecimals(t.step)),n.value=h,i.innerHTML=h,null!=t.max&&(s.style.width=h/t.max*100+"%"),p("change",t.value))},enumerable:!0,configurable:!0});let f=!1;Object.defineProperty(t,"isFocused",{get:function(){return f},set:function(e){null!=e&&(f=e,f?(t.root.classList.add("range-input-control--focused"),p("focus",t)):(p("blur",t),t.root.classList.remove("range-input-control--focused")))},enumerable:!0,configurable:!0});let p=function(e,...n){d[e].forEach((e=>e(...n,t)))};this.on=function(e,t){return d[e]=d[e]||[],d[e].push(t),this},this.off=function(e,t){const n=d[e]||[],s=n.indexOf(t);return~s&&n.splice(s,1),this};let g=function(){n.value=t.value,i.innerHTML=Number(t.value).toFixed(r.countDecimals(t.step)),null!=t.max&&(s.style.width=t.value/t.max*100%NaN),m()},m=function(){c.root_mousedown=function(e){if(e.stopPropagation(),t.root.classList.contains("range-input-control--disabled")||t.root.classList.contains("range-input-control--mouse-move-mode")||t.root.classList.contains("range-input-control--key-input-mode"))return;t.isFocused=!0;let s=e.touches?e.touches[0].pageX:e.pageX;e.touches?e.touches[0].pageY:e.pageY,u=!0,a=!0,l=s,document.body.appendChild(o),o.focus(),t.root.classList.contains("range-input-control--mouse-move-mode")||t.root.classList.add("range-input-control--mouse-move-mode");let i=t.root.getBoundingClientRect(),r=function(e){if(!a)return;u=!1,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();let n=e.touches?e.touches[0].pageX:e.pageX;e.touches?e.touches[0].pageY:e.pageY;let s=(n-l)/i.width*(t.max-t.min);0==n?t.value=t.value-t.step:n==window.screen.width-1?t.value=t.value+t.step:t.value=t.value+s,l=n},c=function(e){a&&(a=!1,t.root.classList.contains("range-input-control--mouse-move-mode")&&t.root.classList.remove("range-input-control--mouse-move-mode"),null!=o&&null!=o.parentNode&&document.body.removeChild(o)),u?(t.root.classList.contains("range-input-control--key-input-mode")||t.root.classList.add("range-input-control--key-input-mode"),n.focus(),n.select()):t.isFocused=!1,document.removeEventListener("mouseup",c,!1),document.removeEventListener("touchend",c,!1),document.removeEventListener("mousemove",r,!1),document.removeEventListener("touchmove",r,!1)};document.addEventListener("mouseup",c,{once:!0}),document.addEventListener("touchend",c,{once:!0}),document.addEventListener("mousemove",r,{passive:!1}),document.addEventListener("touchmove",r,{passive:!1})},t.root.addEventListener("mousedown",c.root_mousedown,!0),t.root.addEventListener("touchstart",c.root_mousedown,!0),c.input_focusout=function(e){t.root.classList.contains("range-input-control--key-input-mode")&&t.root.classList.remove("range-input-control--key-input-mode"),this.value=t.value,t.isFocused=!1},n.addEventListener("focusout",c.input_focusout),c.input_keyup=function(e){27===e.keyCode&&(e.preventDefault(),t.root.classList.contains("range-input-control--key-input-mode")&&t.root.classList.remove("range-input-control--key-input-mode"),this.value=t.value,t.isFocused=!1),13===e.keyCode&&(e.preventDefault(),t.root.classList.contains("range-input-control--key-input-mode")&&t.root.classList.remove("range-input-control--key-input-mode"),t.value=this.value,t.isFocused=!1)},n.addEventListener("keyup",c.input_keyup)},v=function(){t.root.removeEventListener("mousedown",c.root_mousedown,!1),t.root.removeEventListener("touchstart",c.root_mousedown,!1),n.removeEventListener("focusout",c.input_focusout,!1),n.removeEventListener("keyup",c.input_keyup,!1)};this.dispose=function(){for(var e in v(),this.value=null,h=null,this.isFocused=null,f=null,this.min=null,this.max=null,this.step=null,this.root.parentNode.removeChild(this.root),this.root=null,c.root_mousedown=null,c.input_focusout=null,c.input_keyup=null,d.focus.splice(0,d.focus.length),d.focus=null,d.blur.splice(0,d.blur.length),d.blur=null,d.change.splice(0,d.change.length),d.change=null,d=null,t=null,n=null,s=null,i=null,o=null,u=null,a=null,l=null,c=null,d=null,p=null,g=null,m=null,v=null,this)delete this[e]},g()}function v(e){this.root=e,this.isAlphanumeric=e.dataset.isAlphanumeric||!1;let t=this,n=e.querySelector(".text-input"),s=e.querySelector(".text-input-value"),i={root_mousedown:null,input_focusout:null,input_keydown:null,input_keyup:null},r={focus:[],blur:[],change:[]},o=e.dataset.value||"";Object.defineProperty(t,"value",{get:function(){return o},set:function(e){null!=e&&(o=e,n.value=o,s.innerHTML=o,a("change",t.value))},enumerable:!0,configurable:!0});let u=!1;Object.defineProperty(t,"isFocused",{get:function(){return u},set:function(e){null!=e&&(u=e,u?(t.root.classList.add("text-input-control--focused"),a("focus",t)):(a("blur",t),t.root.classList.remove("text-input-control--focused")))},enumerable:!0,configurable:!0});let a=function(e,...n){r[e].forEach((e=>e(...n,t)))};this.on=function(e,t){return r[e]=r[e]||[],r[e].push(t),this},this.off=function(e,t){const n=r[e]||[],s=n.indexOf(t);return~s&&n.splice(s,1),this};let l=function(){n.value=t.value,s.innerHTML=t.value,c()},c=function(){i.root_mousedown=function(e){if(e.stopPropagation(),t.root.classList.contains("text-input-control--disabled"))return;t.isFocused=!0;let s=function(e){n.focus(),n.select()};document.addEventListener("mouseup",s,{once:!0}),document.addEventListener("touchend",s,{once:!0})},t.root.addEventListener("mousedown",i.root_mousedown,!0),t.root.addEventListener("touchstart",i.root_mousedown,!0),i.input_focusout=function(e){this.value=t.value,t.isFocused=!1},n.addEventListener("focusout",i.input_focusout,!0),i.input_keydown=function(e){let n=e.keyCode||e.charCode;t.isAlphanumeric&&(!e.key.match(/[a-zA-Z0-9]/)||0==document.getSelection().toString().length&&37!==n&&39!==n&&6==this.value.length&&8!=n&&46!=n)&&e.preventDefault()},n.addEventListener("keydown",i.input_keydown,!0),i.input_keyup=function(e){27===e.keyCode&&(e.preventDefault(),this.value=t.value,t.isFocused=!1),13===e.keyCode&&(e.preventDefault(),t.value=this.value,t.isFocused=!1)},n.addEventListener("keyup",i.input_keyup,!0)},d=function(){t.root.removeEventListener("mousedown",i.root_mousedown,!1),t.root.removeEventListener("touchstart",i.root_mousedown,!1),n.removeEventListener("focusout",i.input_focusout,!1),n.removeEventListener("keydown",i.input_keydown,!1),n.removeEventListener("keyup",i.input_keyup,!1)};this.dispose=function(){for(var e in d(),this.value=null,o=null,this.isFocused=null,u=null,this.isAlphanumeric=null,this.root.parentNode.removeChild(this.root),this.root=null,i.root_mousedown=null,i.input_focusout=null,i.input_keydown=null,i.input_keyup=null,r.focus.splice(0,r.focus.length),r.focus=null,r.blur.splice(0,r.blur.length),r.blur=null,r.change.splice(0,r.change.length),r.change=null,r=null,t=null,n=null,s=null,i=null,r=null,a=null,l=null,c=null,d=null,this)delete this[e]},l()}this.open=()=>this.isOpen=!0,this.close=()=>this.isOpen=!1,this.update=function(){h(),s.color_wheel.values.hue=n.color.h,s.color_wheel.values.saturation=n.color.s,s.brightness_slider.value=n.color.v,s.hue_input.value=n.color.h,s.saturation_input.value=n.color.s,s.brightness_input.value=n.color.v;let e=r.hsvToRgb(n.color.h,n.color.s,n.color.v);s.red_input.value=e[0],s.green_input.value=e[1],s.blue_input.value=e[2];let i=r.hsvToHex(n.color.h,n.color.s,n.color.v);s.hex_input.value=i.join("").toUpperCase(),t.useAlpha&&(s.alpha_input.value=n.color.a),d()},this.dispose=function(){for(var e in h(),this.isOpen=null,u=null,this.color.dispose(),this.color=null,a=null,this.root.parentNode.removeChild(this.root),this.root=null,this.container=null,i.color_change=null,i.tab_selection_change=null,i.color_wheel_change=null,i.brightness_slider_change=null,i.hue_input_change=null,i.saturation_input_change=null,i.brightness_input_change=null,i.red_input_change=null,i.green_input_change=null,i.blue_input_change=null,i.alpha_input_change=null,i.hex_input_change=null,o.open.splice(0,o.open.length),o.open=null,o.change.splice(0,o.change.length),o.change=null,o.close.splice(0,o.close.length),o.close=null,s.color_wheel.dispose(),s.color_wheel=null,s.brightness_slider.dispose(),s.brightness_slider=null,s.tab_selection_buttons=null,s.red_input.dispose(),s.red_input=null,s.green_input.dispose(),s.green_input=null,s.blue_input.dispose(),s.blue_input=null,s.hue_input.dispose(),s.hue_input=null,s.saturation_input.dispose(),s.saturation_input=null,s.brightness_input.dispose(),s.brightness_input=null,s.hex_input.dispose(),s.hex_input=null,t.useAlpha&&s.alpha_input.dispose(),s.alpha_input=null,t=null,n=null,s=null,i=null,o=null,r=null,l=null,c=null,d=null,h=null,this)delete this[e]},c()}"undefined"!=typeof goog&&goog.declareModuleId("googleChromeLabs.textFragmentPolyfill.textFragmentUtils");let ii=0;function ri(e){return((e,t=document)=>{const n=[],s=t.createRange();for(s.selectNodeContents(t.body);!s.collapsed&&n.length<2;){let i;if(e.prefix){const n=Zs(e.prefix,s);if(null==n)break;Xs(s,n.startContainer,n.startOffset);const r=t.createRange();if(r.setStart(n.endContainer,n.endOffset),r.setEnd(s.endContainer,s.endOffset),Ws(r),r.collapsed)break;if(i=Zs(e.textStart,r),null==i)break;if(0!==i.compareBoundaryPoints(Range.START_TO_START,r))continue}else{if(i=Zs(e.textStart,s),null==i)break;Xs(s,i.startContainer,i.startOffset)}if(e.textEnd){const r=t.createRange();r.setStart(i.endContainer,i.endOffset),r.setEnd(s.endContainer,s.endOffset);let o=!1;for(;!r.collapsed&&n.length<2;){const u=Zs(e.textEnd,r);if(null==u)break;if(Xs(r,u.startContainer,u.startOffset),i.setEnd(u.endContainer,u.endOffset),e.suffix){const r=qs(e.suffix,i,s,t);if(r===js.NO_SUFFIX_MATCH)break;if(r===js.SUFFIX_MATCH){o=!0,n.push(i.cloneRange());continue}if(r===js.MISPLACED_SUFFIX)continue}else o=!0,n.push(i.cloneRange())}if(!o)break}else if(e.suffix){const r=qs(e.suffix,i,s,t);if(r===js.NO_SUFFIX_MATCH)break;if(r===js.SUFFIX_MATCH){n.push(i.cloneRange()),Xs(s,s.startContainer,s.startOffset);continue}if(r===js.MISPLACED_SUFFIX)continue}else n.push(i.cloneRange())}return n})((e=>{const t={};for(const[n,s]of Object.entries(e))Ms.includes(n)&&(t[n]=s.map((e=>Us(e))));return t})((e=>{const t=e.replace(/#.*?:~:(.*?)/,"$1").split(/&?text=/).filter(Boolean);return t.length?{text:t}:{}})(e)).text[0])[0]}function oi(e){let t,n,s=Gs(e.commonAncestorContainer,e).flat(1),i=0!==s.length?s.map((e=>e.textContent)).join(""):e.startContainer.textContent,r=i.lastIndexOf(" ",e.startOffset),o=-1!==r?r:0;if(0===s.length)t=i.slice(e.endOffset).indexOf(" "),n=e.endOffset+(-1!==t?t:0);else{let r=s[s.length-1].length,o=i.length-r+e.endOffset;t=i.slice(o).indexOf(" "),n=o+(-1!==t?t:r)}return i.slice(o,n)}function ui({parent:e,link:t,username:n,threadText:s,threadDate:i,threadComment:r=null}){const o=document.createElement("div");o.classList.add("thread"),o.classList.add("type-tweet");let u=$`<div class="thread-info"><div class="thread-username"><a href="${t}" target="_blank">${n}</a></div><div class="thread-type">Tweet</div></div><div class="thread-body"><div class="thread-text">${s}</div><div class="thread-comment">${Oe(function(e){let t,n,s,i;return n=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=e.replace(n,'<a href="$1" target="_blank">$1</a>'),s=/(^|[^\/])(www\.[\S]+(\b|$))/gim,t=t.replace(s,'$1<a href="http://$2" target="_blank">$2</a>'),i=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t=t.replace(i,'<a href="mailto:$1">$1</a>'),t}(r))}</div></div><div class="thread-datetime">${i.toLocaleString()}</div>`;return e.insertBefore(o,e.firstChild),Z(u,o),o}window.customElements.define("table-of-contents",class extends te{constructor(){super()}render(){return $`<nav role="navigation"><strong>Contents</strong> ${this.__children}</nav>`}}),window.customElements.define("tex-math",class extends De{static get dependencies(){return[{name:"katex",version:"0.15.3",module:"dist/katex.mjs",main:"dist/katex.min.js",css:"dist/katex.min.css"}]}static get properties(){return{mode:{type:String},code:{type:String},leqno:{type:Boolean},fleqn:{type:Boolean,converter:e=>"false"!==e},minRuleThickness:{type:Number},definitions:{type:Array}}}constructor(){super(),this.mode="display",this.leqno=!1,this.fleqn=!1,this.definitions=this.hasAttribute("definitions")?JSON.parse(this.getAttribute("definitions")):[]}initialChildNodes(e){!this.hasAttribute("code")&&e.length&&(this.code=e[0].textContent)}addAugmentations(){let e=this.code;for(let t=0;t<this.definitions.length;t++){const{replace:n,symbol:s,id:i}=this.definitions[t];e=e.replaceAll(n,`\\htmlClass{maug maug-${i}}{${s}}`)}return e}prepareMath(){return this.addAugmentations()}render(){const e=this.getDependency("katex");if(!e||!this.code)return;const t="display"===this.mode,n={throwOnError:!1,displayMode:t,leqno:this.leqno,fleqn:this.fleqn,minRuleThickness:this.minRuleThickness,trust:({command:e})=>"\\htmlClass"===e,strict:e=>"htmlExtension"===e?"ignore":"warn"},s=document.createElement(t?"div":"span"),i=this.prepareMath();return e.render(i,s,n),setTimeout((()=>{const n=s.querySelectorAll(".enclosing");for(const s of n){const n=[...s.classList].find((e=>e.startsWith("maug-"))).slice("maug-".length);let{symbol:i,definition:r}=this.definitions.find((e=>e.id===n));i=i.replaceAll("@",""),r=r.replaceAll("@","");const o=document.createElement("span");o.className="math-aug-window",o.style.borderBottomColor="black",e.render(`${i}:\\text{${r}}`,o,{throwOnError:!1,displayMode:!1,leqno:this.leqno,fleqn:this.fleqn,minRuleThickness:this.minRuleThickness}),s.addEventListener("focusout",(()=>{o.style.display="none"})),s.addEventListener("keydown",(e=>{"Enter"==e.key?(o.style.display="inline-block",e.stopImmediatePropagation()):"Escape"==e.key&&(o.style.display="none")})),s.appendChild(o),o.appendChild(xe(s,o,t)),o.style.display="none",s.addEventListener("click",(e=>{o.style.display="inline-block",e.stopImmediatePropagation()})),s.setAttribute("tabindex",0)}}),200),s}}),window.customElements.define("annotation-thread",class extends te{constructor(){super(),document.addEventListener("mouseup",this.mouseUp.bind(this)),async function(){return await async function(){return[{name:"Vishal Devireddy",author:"VishalDevireddy",link:"https://twitter.com/VishalDevireddy/status/1600712215908474880",time:"2022-12-08T04:41:46.000Z",text:"(another test tweet)\nsomething something generalization\n\n https://t.co/AmI4MoHBbK",fragment:"#:~:text=The%20main%20components%20of%20our%20implementation%20are%20the%20UI%2C%20Text%20Fragments%2C%20Twitter%20web%20intents%2C%20and%20our%20server%20that%20searches%20Twitter."},{name:"Vishal Devireddy",author:"VishalDevireddy",link:"https://twitter.com/VishalDevireddy/status/1600711582967009280",time:"2022-12-08T04:39:15.000Z",text:"(This is a test tweet for a class project, pls ignore)\n\n https://t.co/ZXwZMtrJ7u.",fragment:"#:~:text=searching%20through%20the-,past%20week%20of%20tweets"}]}()}().then((e=>{console.table(e);for(const t of e){const e=ri(t.fragment),n=e?oi(e):"Unknown";e&&this.highlightRange(e,null,t.fragment),ui({parent:this.querySelector(".anno-threads"),link:t.link,username:t.name,threadText:n,threadDate:new Date(t.time),threadComment:t.text})}})),setTimeout((()=>{this.openTab()}),1e3)}mouseUp(){const e=window.getSelection();if(!e.toString())return;const t=this.createOnlyTooltip(e.getRangeAt(0));document.addEventListener("selectionchange",(()=>{t.style.display="none"})),t.querySelector(".tooltip-tweet").addEventListener("mousedown",(()=>{this.highlight(e,t,!0)})),t.querySelector(".tooltip-highlight").addEventListener("mousedown",(()=>{this.highlight(e,t)})),t.querySelector(".tooltip-highlight").removeEventListener("mousedown",(()=>{this.highlight(e,t)})),t.querySelector(".tooltip-tweet").removeEventListener("mousedown",(()=>{this.highlight(e,t,!0)}))}createOnlyTooltip(e){const t=e.getBoundingClientRect(),n=document.body.querySelector("article"),s=t.x+t.width/2+window.scrollX-30,i=t.y-40+window.scrollY,r=document.createElement("div");r.classList.add("anno-tooltip"),r.style.top=`${i}px`,r.style.left=`${s}px`;let o=$`<div class="tooltip-tweet"><div class="icon-tweet"></div></div><div class="tooltip-highlight"><div class="icon-highlight"></div></div>`;return n.insertBefore(r,n.firstChild),Z(o,r),r}highlight(e,t,n=!1){let s=e.getRangeAt(0);const i=this.highlightRange(s,t,e,n);e.removeAllRanges(),function({parent:e,username:t,threadText:n,threadDate:s,threadComment:i=null}){const r=document.createElement("div");r.classList.add("thread"),r.classList.add("type-highlight");let o=$`<div class="thread-info"><div class="thread-username">${t}</div><div class="thread-type">Highlight</div></div><div class="thread-body"><div class="thread-text">${n}</div><div class="thread-comment">${i}</div></div><div class="thread-datetime">${s.toLocaleString()}</div>`;e.insertBefore(r,e.firstChild),Z(o,r)}({parent:this.querySelector(".anno-threads"),username:"You",threadText:i,threadDate:new Date,threadComment:""})}highlightRange(e,t,n,s=!1){console.log(e,n);let i=oi(e);const r=function(e,t,n){e=`"${e}"`;let s=`https://twitter.com/intent/tweet?text=${encodeURIComponent(e)}`;try{if("string"==typeof t)n+="#:~:text="+t;else{const e=((e,t=Date.now())=>{try{return gs(e,t)}catch(e){return console.error("Fragment generation error",e),e.isTimeout?{status:fs}:{status:ps}}})(t);if(0===e.status){const t=e.fragment,s=t.prefix?`${encodeURIComponent(t.prefix)}-,`:"",i=t.suffix?`,-${encodeURIComponent(t.suffix)}`:"",r=encodeURIComponent(t.textStart);n+="#:~:text="+s+r+(t.textEnd?`,${encodeURIComponent(t.textEnd)}`:"")+i}}s+=`&url=${encodeURIComponent(n)}`}catch(e){console.error("Error generating fragment",e)}return s}(i,n,window.location.href);let o=((e,t=document)=>{if(e.startContainer.nodeType!=Node.TEXT_NODE||e.endContainer.nodeType!=Node.TEXT_NODE)return[];if(e.startContainer===e.endContainer){const n=t.createElement("mark");return n.setAttribute("class","annotation-highlight"),e.surroundContents(n),[n]}const n=e.startContainer,s=e.cloneRange();s.setEndAfter(n);const i=e.endContainer,r=e.cloneRange();r.setStartBefore(i);const o=[];e.setStartAfter(n),e.setEndBefore(i);const u=e=>!e.parentNode||u(e.parentNode)&&!("CITE-REF"===e.nodeName||"CROSS-REF"===e.nodeName||e.className&&e.classList.contains("enclosing")),a=t.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:function(t){return e.intersectsNode(t)&&u(t)?Is.includes(t.tagName)||t.nodeType===Node.TEXT_NODE?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT}});let l=a.nextNode();for(;l;){if(l.nodeType===Node.TEXT_NODE){const e=t.createElement("mark");e.setAttribute("class","annotation-highlight"),l.parentNode.insertBefore(e,l),e.appendChild(l),o.push(e)}l=a.nextNode()}const c=t.createElement("mark");c.setAttribute("class","annotation-highlight"),s.surroundContents(c);const d=t.createElement("mark");return d.setAttribute("class","annotation-highlight"),r.surroundContents(d),[c,...o,d].filter((e=>{let t=e.getBoundingClientRect();return!(0===t.height&&0===t.width)}))})(e,document);if(console.log("marks",o),o.forEach((e=>{var n;(n=e).addEventListener("mouseover",(()=>{t.style.display="flex",o.forEach((e=>{e.classList.add("hovered")}))})),n.addEventListener("mouseout",(async e=>{o.forEach((e=>{e.classList.remove("hovered")})),o.includes(e.target)||(await new Promise((e=>setTimeout(e,500))),t&&(t.style.display="none"))})),n.addEventListener("mousedown",u)})),t){let e=t.querySelector(".tooltip-highlight");t.querySelector(".tooltip-tweet").addEventListener("mousedown",(()=>{u()})),e&&(e.className="tooltip-remove",e.textContent="X",e.addEventListener("mousedown",(()=>{null.remove?.(),t.remove(),((e,t=document)=>{for(const n of e){const e=t.createRange();e.selectNodeContents(n);const s=e.extractContents(),i=n.parentNode;i.insertBefore(s,n),i.removeChild(n)}})(o)})))}function u(){const e=(new Date).getTime();e-ii>200&&(ii=e,window.open(r,"_blank"))}return s&&u(),i}openTab(){let e=this.querySelector(".anno");e.open?(e.open=!1,e.style.transform="translate(0, 0)"):(e.open=!0,e.style.transform="translate(-420px, 0)")}openColor(){let e=this.querySelector(".anno-color"),t=this.querySelector(".anno-button"),n=this.querySelector(".anno-color-button"),s=this.querySelector(".anno-side-tray");e.open?(e.open=!1,s.style.width="30px",t.style.transform="translate(0, 0)",n.style.transform="translate(0, 0)",s.style.height="300px",n.textContent="+"):(e.open=!0,t.style.transform="translate(0, 118px)",n.style.transform="translate(0, 118px)",s.style.height="430px",s.style.width="180px",n.textContent="-")}firstUpdated(){this.colorPicker=new si({container:this.querySelector(".anno-color"),theme:"light"}),this.colorPicker.on("change",(e=>{document.querySelector("article").style.setProperty("--highlight-color",`hsla(${e.h},${e.s}%,${e.v}%, ${e.a})`),this.requestUpdate()})),this.requestUpdate()}render(){return $`<div class="anno"><div class="anno-tray"><div class="top-nav"><div class="title"><h2 style="margin:0">Discussions<h3></h3></h2></div></div><div class="anno-threads"></div></div><div class="anno-side-tray"><div class="anno-color"></div><div class="anno-color-button" @click="${this.openColor}">+</div><div class="anno-button" @click="${this.openTab}"><p style="transform:rotate(90deg) translate(-5px,-2px);margin:0">tweets</p></div></div></div>`}}),window.addEventListener("DOMContentLoaded",(()=>{Ne(document.querySelector("article"))}));

    </script>
</html>